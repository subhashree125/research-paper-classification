{
  "Abstract": "Effectively designing molecular geometries is essential to advancing pharmaceu-tical innovations, a domain, which has experienced great attention through thesuccess of generative models and, in particular, diffusion models. However, currentmolecular diffusion models are tailored towards a specific downstream task andlack adaptability. We introduce UniGuide, a framework for controlled geometricguidance of unconditional diffusion models that allows flexible conditioning duringinference without the requirement of extra training or networks. We show howapplications such as structure-based, fragment-based, and ligand-based drug designare formulated in the UniGuide framework and demonstrate on-par or superiorperformance compared to specialised models. Offering a more versatile approach,UniGuide has the potential to streamline the development of molecular generativemodels, allowing them to be readily used in diverse application scenarios.",
  "Introduction": "Diffusion models have emerged as an important class of generative models in various domains,including computer vision , signal processing , computational chemistry, and drug discovery. By gradually adding noise to data samples and learning the reverse process of removing noise,diffusion models effectively transform noisy samples into structured data . In the context ofdrug discovery, it is essential to effectively address downstream tasks, which often pose specificgeometric conditions. Examples of this include (i) Structure-based drug design (SBDD) that aimsto create small ligands that fit given receptor binding sites , (ii) Fragment-based drug design(FBDD) that designs molecules by elaborating known scaffolds , or (iii) Ligand-based drugdesign (LBDD) which generates molecules that fit a certain shape . Recent works address thesetasks by either incorporating specialised models or focusing on conditions that directly resemblemolecular structures. In both cases, this narrow focus restricts their adaptability to new or slightlyaltered settings. We address the challenge of adaptability by introducing UniGuide, a method that unifies guidance forgeometry-conditioned molecular generation, see . The key element for achieving this unificationis the condition map, which transforms complex geometric conditions to match the diffusion models",
  "arXiv:2501.02526v1 [q-bio.BM] 5 Jan 2025": ": UniGuide handles diverse conditioning modalities for guidance, including: (i) a targetreceptor for SBDD, (ii) additional molecular fragments for FBDD, or (iii) a predefined 3D shapefor LBDD. It combines a source condition s S and the unconditional model (zt, t) within itscondition map to enable self-guidance. The flexible formulation of our approach can be generalisedto new geometric tasks, for example, conditioning on atomic densities. configuration space, thereby enabling self-guidance without the need for external models. Likeother guidance-based approaches, UniGuide does not constrain the generality of the underlyingmodel. Moreover, our method is the most versatile, extending beyond guiding molecular structures toleveraging complex geometric conditions such as volumes, surfaces, and densities, thereby enablingthe unified tackling of diverse drug discovery tasks. For complex conditions specifically, previousworks primarily rely on conditional diffusion models for effective condition encoding . Withour method, we are able to tackle the same tasks, while overcoming major drawbacks: UniGuideeliminates the need for additional training and, more importantly, avoids constraining the model tospecific tasks. We demonstrate the wide applicability of UniGuide by tackling a variety of geometry-constraineddrug discovery tasks. With performance either on par with or superior to tailored models, we concludethat UniGuide offers advantages beyond its unification. Firstly, while the novelty of conditionalmodels often stems from the condition incorporation, our method redirects focus to advancingunconditional generation, which directly benefits multiple applications. Furthermore, this separationof model training and conditioning allows us to tackle tasks with minimal data, a common scenarioin the biological domain.",
  "Related work": "Diffusion models and controllable generationDiffusion models are generative modelsachieving state-of-the-art performance across various domains, including the generation of images, text , or point clouds . Conditional diffusion models are based on the sameprinciple but incorporate a particular condition in their training, allowing for the controlled generation.Alternatively, classifier guidance relies on external models for controllable generation. Priorworks in this context primarily focused on global properties , lacking the capacity to conditionon the geometric conditions central to our work. For instance, Bao et al. demonstrate controlover molecule generation based on desired quantum properties.De novo molecule generationResearch on de novo molecule generation focused extensively ongenerating molecules using their chemical graph representations . However, these methodsare limited in modelling the molecules conformation information and are, therefore, not ideally suitedfor several drug-discovery settings, such as target-aware drug design. Recently, attention has shiftedtowards generating molecules in 3D space, utilising variational autoencoders , autoregressivemodels , flow-based models , and diffusion-based approaches . Conditional generation of moleculesDownstream applications of molecular generation can becategorised by their condition modality. In the case of SBDD , Schneuing et al. andGuan et al. , for example, introduce models that simultaneously operate on protein pockets andligands. In the conditional case, the pocket context is fixed throughout the generation. Moreover,FBDD imposes (multiple) scaffolds as a constraint . Igashov et al. expand givenscaffolds by generating the molecule around the fixed scaffolds. In a related task of FBDD, linkerdesign with pose estimation, as discussed in , further generate the rotation of the given scaffolds.SBDD and FBDD rely on the availability of high-quality data of protein pockets, which is often scarce.For this reason, LBDD aims to generate molecules that match the same 3D volume of referenceligands that are known to bind to the target of interest . Chen et al. specifically train ashape encoder to capture the molecular shape of a reference ligand and use the resulting embeddingto train a conditional diffusion model.",
  "Controlling the generation of diffusion models": "Diffusion Models learn a Markov Chain that involves a forward process to perturb data from adistribution q(z) and learn to reverse the process to generate new samples from a tractable prior, forexample, a normal distribution. Given a data point sampled from the true underlying distribution,zdata q(z), the forward process q(zt|zt1) gradually adds Gaussian noise:",
  "where (t) = (t) 1": "2 tS balances the conditional update.Eq. (9) requires sampling fromlog p(c | zt) to which we do not have access. Assuming the condition c lies in the same spaceas zt, we can follow Kollovieh et al. and approximate log p(c | zt) as a multivariate Gaussiandistribution:p(c | zt) = Nc | f(zt, t), I,(10)",
  "UniGuide": "To enable the application of unconditional molecular diffusion models to geometric downstreamtasks in drug discovery, we aim to develop a unified guidance framework, UniGuide, see .Importantly, we seek to enable guidance from arbitrary geometric conditions s S, where S denotesa general space of source conditions. However, the source conditions s cannot be directly used forthe loss computation in Eq. (12) when they do not match the configuration space Z. To address this challenge, we introduce condition maps C, which bridge the gap between arbitrarysource conditions s and target conditions c suitable for guidance. In Sec. 4.1, we start with its generalformulation and continue to derive a condition map CZ for the special case where S = Z. This willbe useful when discussing the application of UniGuide to various drug discovery tasks in Sec. 4.2.We also demonstrate how to derive a task-specific condition map CV for ligand-based drug design. NotationIn 3D space, the configuration of molecules, including proteins, can be represented bya set of tuples z = {(xi, hi)}Ni=1 Z, where xi R3 and hi Rd refer to coordinates andfeatures of a node zi = (xi, hi), respectively. The space of configurations is denoted by Z andincludes configurations of varying size N. We distinguish between different configuration entitiesvia superscripts, i.e. refer to molecules M and proteins P through zM and zP, respectively. Thecollection of coordinates x = {x1, . . . , xN} RN3 X defines the conformation of a moleculeM or protein P. We represent arbitrary geometric conditions with the variable s S, and conditionsthat can be used for guidance with the variables c Z.",
  "Unified self-guidance from geometric conditions s S": "The concept of a condition map C is essential to our method, enabling guidance from conditionss S in a unified fashion, where S represents a space of general geometric objects such as structures,densities, or surfaces. These geometric objects do not necessarily match the configuration space Z,i.e. S = Z, preventing the computation of the guiding score function from Eq. (12). We overcomethis challenge by defining C as a transformation that maps s to a suitable target condition c Z,which is then utilised for self-guidance.",
  "2ztz0 C(s, z0)22= ztL(z0, s),(15)": "where z0 = f(zt, t) is the estimate of z0 given the unconditional model (zt, t) obtained accordingto Eq. (11) and c = C(s, z0) is the target condition produced by the condition map. In thisformulation, c can also be understood as guidance target of the unconditional model. It is important to highlight that Eq. (15) should not destroy the underlying properties of the uncon-ditional generative process. In particular, if the unconditional model is equivariant to a set oftransformations G, e.g. rotations and translations, as is common in the molecular domain, we want toretain equivariance also in the guidance signal. Hence, the self-guided model should satisfy",
  "Proof. We prove Theorem 4.1 in App. B": "Using Theorem 4.1, we can guarantee equivariant guidance signals if the condition maps C(s, z)are invariant and equivariant under rigid transformations concerning the source condition s andconfiguration z, respectively. Guidance in the special case of S = ZIn the case where the source condition s directly definessubset A of m < N nodes of the configuration, i.e. S = Z, we can fully specify the condition map.This is feasible because the condition map no longer needs to bridge different spaces; it only needs toensure equivariance, as the loss computation between s and the configuration is already possible. Todistinguish this special case from the general setting, we denote s = z Rm(3+d) and refer to thedefined subset within the configuration z0 by zA0 . In order to satisfy the requirements on Cz, zA0as stated by Theorem 4.1, we align z with zA0 byusing the Kabsch algorithm . Denoting the resulting transformation with TzA0 , we get anz0-equivariant condition map:",
  "We emphasise that although the loss LzA0 , zis computed on the subset A, the gradient, as presentedin Eq. (15), is still computed with respect the full configuration zt": "In summary, our method requires only an unconditionally trained model and a suitable conditionmap C, eliminating the need for additional networks or training. Together, this facilitates unifiedself-guidance from arbitrary geometric sources. Importantly, the separation of model training andconditioning enables us to tackle tasks even with minimal data, which is crucial in practical scenarios.In the following section, we discuss the wide applicability of UniGuide by illustrating its applicationto multiple drug discovery tasks.",
  "UniGuide for drug discovery": "Having introduced both the guidance framework and the condition map, we will continue to discusshow to tackle a set of drug discovery tasks within the UniGuide framework. We start with itsapplication to ligand-based drug design (LBDD), which aims to generate a ligand that satisfies apredefined molecular shape. : Surface conditionmap CV : For each atom co-ordinate xi, the closest sur-face points yj are computed.The target condition cx,i isthe projection along the meanof neighbours yi to the insideof the volume by a margin ,where d = yi xi2. Ligand-based drug designLBDD aims to generate novel ligandswith a similar 3D shape as a reference ligand Mref. In this setting,one operates on the molecule level only since the protein informationis assumed to be unknown. However, to still generate active ligandsthat bind to a protein pocket, one leverages the 3D shape informationof a reference molecule. Specifically, the goal is to modify thegenerative process to generate a ligand z0 with a similar 3Dshape but different molecular structure than Mref. With Sec. 4.1introducing all required concepts, we can readily formulate a surfacecondition map CV suitable to tackle the task of LBDD, see : To represent Mrefs 3D shape, we identify our source conditions with a set of K points y sampled uniformly from the referenceligands surface V , y RK3 = S. As no features are guided, weformulate CV with respect to the conformation space X = RN3:",
  "y x0 cx,(19)": "where x0 denotes the conformation of the clean data point estimationz0 as computed by Eq. (11). To satisfy Theorem 4.1, CV firstaligns y with x0 by a rotation Rx0 R33 resulting from the ICPalgorithm . For every atom coordinate xi, CV subsequentlycomputes the mean yi over xis k closest surface points:",
  "d (yi xi) ,if xi inside V d < xi ,otherwise ,(21)": "where d denotes the distance to the surface, d = yi xi2, and the required distance to thesurface. Note that the target condition cx represents a valid conformation inside the surface V ,and that CV effectively bridges spaces from S to X. Consequently, when using CV , the guidancesignal is derived from Eq. (15) with the loss function L(z0, y). The full algorithm for guidance usingCV is presented in App. D.1. Structure-based drug designThe goal of SBDD is to design a ligand that binds to a target proteinpocket s. In this setting, one operates on both the molecule and protein level. Technically, weare interested in generating a ligand zM0conditioned on the protein configuration zP. With theunconditional diffusion model (zt, t), zt = (zMt , zPt ), approximating the joint distribution ofligand-protein pairs p(zMdata, zPdata), one can readily see that the source condition directly correspondsto the configuration of the protein pocket. Hence, we can use CZ from Sec. 4.1 and identify z withzP. The guidance signal then follows from the loss L(zP0 , zP) with cP = CZ(zP, zP0 ) as defined inEq. (18). We describe the sampling algorithm for the SBDD task in App. E.1. Fragment-based drug designFBDD aims to design a ligand by optimising a molecule aroundfragments F that bind weakly to a receptor. Similarly to SBDD, one operates on both the moleculeand protein level. Technically, we are interested in generating a ligand zM0conditioned on boththe protein and the fragment configuration, zP and zF, respectively. Considering the same kind ofunconditional model (zt, t) as in SBDD, we can use CZ from Sec. 4.1. Only now, we identify zwith both zP and zF and write zA with A = P F. Using Eq. (18), the guidance signal directlyfollows from L(zA0 , zPF) with cP = CZ(zPF, zPF0). The sampling algorithm is similar to theone described in App. E.1.",
  "UniGuide (EDM)0.749 0.040.860 0.040.212 0.040.206 0.063.5360.736 0.04": "fixed, or linker design , where the connection between separated fragments has to be optimisedthrough the generative process, see . Note that these tasks differ primarily in their applicationand can be treated identically from a technical perspective within UniGuide. In addition, one can alsoconsider variations where the protein information zP is discarded. This usually aligns with switchingto an unconditional model that solely models the distribution over molecules. We present resultsfor this configuration in Sec. 5.3. Furthermore, we would like to highlight that it is possible to combine guidance strategies withinUniGuide. For example, one could incorporate a version of the surface condition map CV for FBDDto provide an additional geometric guidance signal for the atoms not included in F. LimitationsDrug discovery also involves tasks beyond purely geometric conditions, encompassingglobal graph properties . These are excluded from the UniGuide framework. Additionally,UniGuide requires the unconditional model to be trained on a matching configuration space. Wediscuss the broader impact of our work in App. A.",
  "Results": "In this section, we compare UniGuide to state-of-the-art models across various drug discovery tasks.To highlight the wide range of tasks to which unconditional models can be adapted through UniGuide,we conduct experiments on ligand-based (Sec. 5.1), structure-based (Sec. 5.2) and fragment-based(Sec. 5.3) drug design. We demonstrate that UniGuide performs competitively or even surpassesspecialised baseline models, underscoring its practical relevance and transferability to diverse drugdiscovery scenarios.",
  "Ligand-based drug design": "DatasetFollowing Chen et al. , we employ the MOSES dataset for the ligand-based drugdesign task . We evaluate on a test set consisting of 1000 reference ligands, from which the 3Dshape conditions are extracted. For every shape condition Mref, 50 samples are generated. We referto App. D.1 for further details on the evaluation setup. BaselinesFor the LBDD task, we compare UniGuide to ShapeMol, a conditional diffusion modelthat is trained by conditioning on learned latent embeddings of the molecular surfaces . Chenet al. also propose a correction technique that adjusts the atom positions based on their distanceto the reference ligands nodes, which is refered to as ShapeMol+g. Additionally, we include asbaselines Virtual Screening (VS) , a shape-based virtual screening tool, and SQUID , avariational autoencoder that decodes molecules by sequentially attaching fragments with fixed bondlengths and angles. For this task, we evaluate UniGuide equipped with the surface condition mapCV from Eq. (21) in conjunction with two unconditionally trained diffusion models, ShapeMol [U]and EDM as well as the conditional model ShapeMol . The only shape column inTab. 1 indicates whether a method uses solely the reference ligands shape or also incorporates itsatom positions. We compare UniGuide with an alternative guidance approach adapted from Guan et al. inApp. D.4 and refer to App. C and App. D.3 for further information on the unconditional models andthe guidance parameters, respectively. In addition, inspired by the performance of UniGuide on the : Structure-Based Drug Design. Quantitative comparison of generated ligands for targetpockets from the CrossDocked and Binding MOAD test sets. Results taken from the respective worksare indicated with (). We highlight the best conditioning approach for the DiffSBDD backbone inbold and underline the best approach over all methods.",
  ": Examples of the two shape-conditioned lig-ands generated by UniGuide. The goal is to have lowmolecular graph similarity and high shape similarity": "EvaluationThe goal of LBDD is to dis-cover novel molecules that fit within a given3D shape. This can be quantified by a high3D shape similarity and low graph similaritycompared to the reference ligand, as illus-trated in as well as App. D.2. Wehighlight this trade-off by reporting the ratioof these similarities in Tab. 1 as SimS/SimG,which constitutes the most important met-ric for this task. We follow Chen et al. and further evaluate the mean and maximumshape similarities SimS and max SimS, re-spectively, per reference ligand, measured viathe volume overlap between the two alignedmolecules. Additionally, we report the graphsimilarity SimG defined as the Tanimoto sim-ilarity between the generated and referenceligand, and the graph similarity max SimGof the generated molecule with the maximum shape similarity. Further metrics concerning the qualityof the generated ligands are provided in App. D.2. Both in terms of shape similarity and graph similarity, guiding the generation of EDM with UniGuideoutperforms other task-specific conditioning mechanisms and even the Virtual Screening baseline.Emphasised by the Ratio metric across all evaluated methods, UniGuide demonstrates that it is ableto generate diverse molecules with very similar shapes compared to the reference ligand. Remarkably,UniGuide achieves higher shape similarity than ShapeMol+g, even though the conditional modelis explicitly guided towards the position of the reference ligand through the position correctiontechnique. UniGuide, on the other hand, does not require information about the references atompositions at all to generate novel, high-quality ligands. This highlights how UniGuide and the designof condition maps enables unconditional models like EDM, that have not been tailored or trained forthe LBDD task, to achieve state-of-the-art performance on new tasks.",
  "UniGuide (EDM)0.64 0.163.63 1.080.49 0.6289.172.187.958.8": "The Binding MOAD dataset is preprocessed as discussed in Schneuing et al. , resulting in 130test proteins. Per target pocket, 100 ligands are generated. We evaluate the generation of ligands onmodels that are trained on the full-atom context of the pockets in Tab. 2 and results of models trainedon the C representation of the pockets are provided in App. E.5. BaselinesWe compare UniGuide to two autoregressive models designed for the SBDD task:3D-SBDD and Pocket2Mol . We further include TargetDiff and DecompDiff ,conditional diffusion models for SBDD that fix the protein pocket context during every step of thediffusion process. We exclude approaches with explicit drift terms like Guan et al. and Huanget al. from the comparison, as UniGuides SBDD condition map does not include drift termscurrently, but can be readily extended to do so. Schneuing et al. present two techniques forcontrolled structure-based generation: (i) DiffSBDD-cond, a conditional diffusion model similarto and (ii) DiffSBDD, an inpainting-inspired technique that modifies the generative process ofan unconditional diffusion model that jointly generates protein-ligand pairs. Across datasets, bothUniGuide and DiffSBDD control the same unconditional ligand-protein diffusion model. We providemore information and further evaluation regarding this base model in App. E.2 and App. E.3 andinvestigate the influence of the guidance scale S as well as the resampling trick , a technique thatmodifies the generative process to better harmonise the generated ligand with the controlled pockets,in App. E.4 and App. E.5. EvaluationAs the task of SBDD is to generate ligands that bind well to a given protein pocket, weassess generated ligands based on affinity-related metrics (Vina Score, Vina Min and Vina Dock),which estimate the binding affinity between the generated ligands and a given test receptor .Additionally, we measure the quality of the generated ligands using two chemical properties: thedrug-likeness (QED) and the synthetic accessibility (SA) .",
  ": Qualitative example of a test protein pocket(6c0b) from the Binding MOAD dataset. We showthe reference ligand (grey) and samples generated byUniGuide (blue)": "Tab. 2 demonstrates that, without addi-tional training or external networks, UniGu-ide performs competitively with even thehighly specialised conditional models likeTargetDiff and DecompDiff. Our resultsindicate that not fully converging to thetarget protein pocket due to soft guidance,compared to, for example, DiffSBDDsinpainting-inspired technique, is not a lim-itation in practice. Rather, it suggests thatutilising self-guidance in combination witha suitable condition map generates well-harmonised ligand-protein pairs. This isalso reflected in the properties of the gen-erated ligands, where UniGuide achievesgood drug-likeness (QED) and synthetic accessibility (SA) scores. We provide additional qualitativeexamples for the SBDD task in , which showcase that UniGuide not only generates drug-likeligands but is even able to improve over the VINA Dock metric of the reference ligand.",
  "Fragment-based drug design": "Datasets & BaselinesIn the following, we investigate linker design, a subfield of fragment-baseddrug design. We follow Igashov et al. and decompose ligands from the ZINC dataset withthe MMPA algorithm . Note that the ZINC dataset does not contain pocket information, and theevaluated approaches operate solely at the molecular level. We compare UniGuide to DiffLinker, a diffusion-based conditional model that fixes fragments in space. Additionally, we evaluate the variational autoencoder-based methods DeLinker and 3DLinker , adapted as describedin Igashov et al. . We provide more information on the experimental setup as well as theunconditionally trained EDM model in App. F.1 and App. C.",
  ": For various pocket-conditioned FBDD tasks,we show reference ligands (grey), desired fragments(magenta), and ligands generated by UniGuide (blue)": "EvaluationFollowing Igashov et al. ,we evaluate the generated linkers and lig-ands with respect to their properties (SA,QED, Number of Rings and 2D Filters). Weadditionally measure (i) the uniqueness ofthe generated samples, (ii) the recovery ofthe reference ligands, and (iii) the validity,which combines the chemical validity andthe successful linking of the fragments. Using UniGuide to control the EDM gener-ation enables the successful combination ofthe condition fragments and the generationof diverse linkers. Even compared to task-specific models, UniGuide is able to per-form competitively across different metrics.Importantly, UniGuide enables the same un-conditional model (EDM) to tackle both thelinker design task as presented in Tab. 3 aswell as the LBDD task as presented in Tab. 1without additional training. Note that, whileDiffLinker is specifically designed to gener-ate linkers, UniGuide readily generalises toother tasks within the FBDD setting, such asfragment growing and scaffolding, see . Additionally, UniGuide is agnostic to the fragmentationprocedure used to obtain the condition scaffolds, meaning that UniGuide will generalise to unseenfragments as long as the underlying molecule fits within the training distribution. In App. F.2, wedemonstrate how the same unconditional model can be adapted for these tasks. Our quantitativeevaluation highlights the benefits achieved through the unification of controlled generation providedby UniGuide.",
  "Conclusion": "In this work, we present UniGuide, a unified way of controlling the generation of molecular diffusionmodels towards geometric constraints. UniGuide generalises to a multitude of drug discovery taskswithout the need for conditioning networks or specialised training protocols, enabling UniGuide tofind applicability also in scenarios where little data is available. By demonstrating that specialisationis not a necessity and that a more flexible, unified method outperforms specialised approaches acrosstasks and datasets, we open up new avenues for streamlined and flexible generative models withwide-ranging applications. AcknowledgementsSA, LH, and JS are thankful for valuable feedback from Marcel Kollovieh,Leo Schwinn, and Alessandro Palma from the DAML group and Theis Lab. SA is supported bythe DAAD programme Konrad Zuse Schools of Excellence in Artificial Intelligence, sponsored bythe Federal Ministry of Education and Research. LH is supported by the Helmholtz Associationunder the joint research school Munich School for Data Science - MUDS. FJT acknowledgessupport from the Helmholtz Associations Initiative and Networking Fund through Helmholtz AI(ZT-I-PF-5-01). FJT further acknowledges support by the BMBF (01IS18053A). In addition, FJTconsults for Immunai Inc., Singularity Bio B.V., CytoReason Ltd, and Omniscope Ltd and has anownership interest in Dermagnostix GmbH and Cellarity. Robin Rombach, Andreas Blattmann, Dominik Lorenz, Patrick Esser, and Bjrn Ommer. High-resolution image synthesis with latent diffusion models. In Proceedings of the IEEE/CVFconference on computer vision and pattern recognition, pages 1068410695, 2022.",
  "N Anand and T Achim. Protein structure and sequence generation with equivariant denoisingdiffusion probabilistic models. arXiv, 2022. doi: 10.48550. arXiv preprint arXiv.2205.15019": "Brian L. Trippe, Jason Yim, Doug Tischer, David Baker, Tamara Broderick, Regina Barzi-lay, and Tommi Jaakkola. Diffusion probabilistic modeling of protein backbones in 3D forthe motif-scaffolding problem, March 2023. URL [cs, q-bio, stat]. Joseph L Watson, David Juergens, Nathaniel R Bennett, Brian L Trippe, Jason Yim, Helen EEisenach, Woody Ahern, Andrew J Borst, Robert J Ragotte, Lukas F Milles, and others. Denovo design of protein structure and function with RFdiffusion. Nature, 620(7976):10891100,2023. Publisher: Nature Publishing Group UK London. Gabriele Corso, Bowen Jing, Regina Barzilay, Tommi Jaakkola, and others. DiffDock: Diffu-sion steps, twists, and turns for molecular docking. In International conference on learningrepresentations (ICLR 2023), 2023. Yuanqi Du, Tianfan Fu, Jimeng Sun, and Shengchao Liu. MolGenSurvey: A Systematic Surveyin Machine Learning Models for Molecule Design. Technical Report arXiv:2203.14500, arXiv,March 2022. URL arXiv:2203.14500 [cs, q-bio]type: article. Leon Hetzel, Simon Bhm, Niki Kilbertus, Stephan Gnnemann, Mohammad Lotfollahi, andFabian Theis. Predicting single-cell perturbation responses for unseen drugs. Technical report,ICLR2022 Machine Learning for Drug Discovery, April 2022. arXiv:2204.13545 [cs, q-bio,stat] type: article.",
  "Jonathan Ho, Ajay Jain, and Pieter Abbeel. Denoising diffusion probabilistic models. Advancesin neural information processing systems, 33:68406851, 2020": "Yang Song, Jascha Sohl-Dickstein, Diederik P Kingma, Abhishek Kumar, Stefano Ermon, andBen Poole. Score-based generative modeling through stochastic differential equations. arXivpreprint arXiv:2011.13456, 2020. Arne Schneuing, Yuanqi Du, Charles Harris, Arian Jamasb, Ilia Igashov, Weitao Du, TomBlundell, Pietro Li, Carla Gomes, Max Welling, Michael Bronstein, and Bruno Correia.Structure-based Drug Design with Equivariant Diffusion Models, June 2023. URL arXiv:2210.13695 [cs, q-bio].",
  "Meng Liu, Youzhi Luo, Kanji Uchino, Koji Maruhashi, and Shuiwang Ji. Generating 3dmolecules for target protein binding. arXiv preprint arXiv:2204.09410, 2022": "Jiaqi Guan, Wesley Wei Qian, Xingang Peng, Yufeng Su, Jian Peng, and Jianzhu Ma. 3dequivariant diffusion for target-aware molecule generation and affinity prediction. arXiv preprintarXiv:2303.03543, 2023. Fergus Imrie, Thomas E Hadfield, Anthony R Bradley, and Charlotte M Deane. Deep generativedesign with 3D pharmacophoric constraints. Chemical science, 12(43):1457714589, 2021.Publisher: Royal Society of Chemistry.",
  "Siyu Long, Yi Zhou, Xinyu Dai, and Hao Zhou. Zero-shot 3d drug design by sketching andgenerating. Advances in Neural Information Processing Systems, 35:2389423907, 2022": "Jascha Sohl-Dickstein, Eric Weiss, Niru Maheswaranathan, and Surya Ganguli. Deep unsuper-vised learning using nonequilibrium thermodynamics. In International conference on machinelearning, pages 22562265. PMLR, 2015. Marcel Kollovieh, Abdul Fatir Ansari, Michael Bohlke-Schneider, Jasper Zschiegner, Hao Wang,and Yuyang Wang. Predict, refine, synthesize: Self-guiding diffusion models for probabilistictime series forecasting. arXiv preprint arXiv:2307.11494, 2023. Wolfgang Kabsch. A solution for the best rotation to relate two sets of vectors. Acta Crystallo-graphica Section A: Crystal Physics, Diffraction, Theoretical and General Crystallography, 32(5):922923, 1976. Publisher: International Union of Crystallography. Wolfgang Kabsch. A discussion of the solution for the best rotation to relate two sets of vec-tors. Acta Crystallographica Section A: Crystal Physics, Diffraction, Theoretical and GeneralCrystallography, 34(5):827828, 1978. Publisher: International Union of Crystallography.",
  "Paul J Besl and Neil D McKay. Method for registration of 3-D shapes. In Sensor fusion IV:control paradigms and data structures, volume 1611, pages 586606. Spie, 1992": "Robert Abel and Sathesh Bhat. Chapter Seven - Free Energy Calculation Guided VirtualScreening of Synthetically Feasible Ligand R-Group and Scaffold Modifications: An EmergingParadigm for Lead Optimization. In Robert A. Goodnow, editor, Annual Reports in MedicinalChemistry, volume 50 of Platform Technologies in Drug Discovery and Validation, pages237262. Academic Press, January 2017. doi: 10.1016/bs.armc.2017.08.007. URL",
  "Hans-Joachim Bhm, Alexander Flohr, and Martin Stahl. Scaffold hopping. Drug DiscoveryToday. Technologies, 1(3):217224, December 2004. ISSN 1740-6749. doi: 10.1016/j.ddtec.2004.10.009": "Chunquan Sheng and Wannian Zhang. Fragment informatics and computational fragment-baseddrug design: an overview and update. Medicinal Research Reviews, 33(3):554598, May 2013.ISSN 1098-1128. doi: 10.1002/med.21255. Daniil Polykovskiy, Alexander Zhebrak, Benjamin Sanchez-Lengeling, Sergey Golovanov,Oktai Tatanov, Stanislav Belyaev, Rauf Kurbanov, Aleksey Artamonov, Vladimir Aladinskiy,Mark Veselov, Artur Kadurin, Simon Johansson, Hongming Chen, Sergey Nikolenko, AlanAspuru-Guzik, and Alex Zhavoronkov. Molecular Sets (MOSES): A Benchmarking Platform forMolecular Generation Models, October 2020. URL [cs, stat]. Jiaqi Guan, Xiangxin Zhou, Yuwei Yang, Yu Bao, Jian Peng, Jianzhu Ma, Qiang Liu, LiangWang, and Quanquan Gu. DecompDiff: Diffusion Models with Decomposed Priors for Structure-Based Drug Design, 2024. URL Version Number:1. Paul G Francoeur, Tomohide Masuda, Jocelyn Sunseri, Andrew Jia, Richard B Iovanisci, IanSnyder, and David R Koes. Three-dimensional convolutional neural networks and a cross-docked data set for structure-based drug design. Journal of chemical information and modeling,60(9):42004215, 2020. Publisher: ACS Publications. Liegi Hu, Mark L Benson, Richard D Smith, Michael G Lerner, and Heather A Carlson. BindingMOAD (mother of all databases). Proteins: Structure, Function, and Bioinformatics, 60(3):333340, 2005. Publisher: Wiley Online Library. Zhilin Huang, Ling Yang, Xiangxin Zhou, Zhilong Zhang, Wentao Zhang, Xiawu Zheng, JieChen, Yu Wang, CUI Bin, and Wenming Yang. Protein-ligand interaction prior for binding-aware 3d molecule diffusion models. The Twelfth International Conference on LearningRepresentations 2024. Andreas Lugmayr, Martin Danelljan, Andres Romero, Fisher Yu, Radu Timofte, and LucVan Gool. Repaint: Inpainting using denoising diffusion probabilistic models. In Proceedingsof the IEEE/CVF conference on computer vision and pattern recognition, pages 1146111471,2022. Amr Alhossary, Stephanus Daniel Handoko, Yuguang Mu, and Chee-Keong Kwoh. Fast,accurate, and reliable molecular docking with QuickVina 2. Bioinformatics (Oxford, England),31(13):22142216, 2015. Publisher: Oxford University Press.",
  "Alexander G Dossetter, Edward J Griffen, and Andrew G Leach. Matched molecular pairanalysis in drug discovery. Drug Discovery Today, 18(15-16):724731, 2013. Publisher:Elsevier": "Priyank Jaini, Lars Holdijk, and Max Welling. Learning equivariant energy based models withequivariant stein variational gradient descent. Advances in Neural Information ProcessingSystems, 34:1672716737, 2021. Maciej Wjcikowski, Piotr Zielenkiewicz, and Pawel Siedlecki. Open Drug Discovery Toolkit(ODDT): a new open-source player in the drug discovery field. Journal of cheminformatics, 7(1):16, 2015. Publisher: BioMed Central.",
  "Mikko J Vainio, J Santeri Puranen, and Mark S Johnson. ShaEP: molecular overlay based onshape and electrostatic potential, 2009": "Freyr Sverrisson, Jean Feydy, Bruno E. Correia, and Michael M. Bronstein. Fast end-to-endlearning on protein surfaces. In 2021 IEEE/CVF Conference on Computer Vision and PatternRecognition (CVPR), pages 1526715276, June 2021. doi: 10.1109/CVPR46437.2021.01502.URL ISSN: 2575-7075. Maciej Wjcikowski, Piotr Zielenkiewicz, and Pawel Siedlecki. Open Drug Discovery Toolkit(ODDT): a new open-source player in the drug discovery field. Journal of Cheminformatics,7(1):26, December 2015. ISSN 1758-2946. doi: 10.1186/s13321-015-0078-2. URL Octavian-Eugen Ganea, Xinyuan Huang, Charlotte Bunne, Yatao Bian, Regina Barzilay, TommiJaakkola, and Andreas Krause. Independent se (3)-equivariant models for end-to-end rigidprotein docking. arXiv preprint arXiv:2111.07786, 2021. Jan Zaucha, Charlotte A. Softley, Michael Sattler, Dmitrij Frishman, and Grzegorz M. Popowicz.Deep learning model predicts water interaction sites on the surface of proteins using limited-resolution data. Chemical Communications, 56(98):1545415457, December 2020. ISSN1364-548X.doi: 10.1039/D0CC04383D.URL Publisher: The Royal Society of Chemistry. Huimin Zhu, Renyi Zhou, Dongsheng Cao, Jing Tang, and Min Li. A pharmacophore-guideddeep learning approach for bioactive molecular generation. Nature Communications, 14(1):6234, October 2023. ISSN 2041-1723. doi: 10.1038/s41467-023-41454-9. URL Publisher: Nature Publishing Group. William E. Lorensen and Harvey E. Cline. Marching cubes: A high resolution 3D surfaceconstruction algorithm. In Proceedings of the 14th annual conference on Computer graphicsand interactive techniques, SIGGRAPH 87, pages 163169, New York, NY, USA, August 1987.Association for Computing Machinery. ISBN 978-0-89791-227-3. doi: 10.1145/37401.37422.URL",
  "AImpact Statement": "Our research holds the promise of significant contributions to the advancement of drug discovery,possibly assisting in the discovery of novel pharmaceutical compounds. Nevertheless, because of itsapplications in drug discovery, this strategy is not without its hazards. The ability to produce variousmolecules with desired properties may not only serve the purpose of beneficial drug developmentbut may also unintentionally result in the creation of dangerous substances or compounds withunexpected effects. These concerns underline the critical need for careful handling when workingwith the structures this method can generate.",
  "UniGuide guides an unconditional diffusion model given an arbitrary condition and a natural choicefor a model operating only on the molecule level is the EDM model as proposed in Hoogeboom et al": "We adapt this model for two tasks presented in this work, namely the LBDD task discussed in Sec. 5.1and the Linker Design task as presented in Sec. 5.3. For these tasks, we train an unconditional EDMmodel both on the MOSES dataset in the configuration as described in Chen et al. andon the ZINC dataset as described in Igashov et al. . For both trainings, we employ thehyperparameter configuration for the GEOM dataset as described in Hoogeboom et al. . We runmulti-GPU trainings on 4 NVIDIA A100 GPUs until convergence, however, a single NVIDIA A100GPU is sufficient for this training and will only increase the training time. For inference, we employthe Resampling trick as discussed in Lugmayr et al. with R = 10 resampling steps and T = 100timesteps. EDM is available under the MIT License.",
  "D.1Implementation details": "We train two unconditional diffusion models, ShapeMol [U] and EDM, to generate 3D moleculeson the MOSES dataset , licensed under the MIT License, for which we generate 3D conformerswith RDKit , available under the BSD 3-Clause License. We use 1, 593, 653 training samples and randomly select 1000 samples for validation. The model architecture of ShapeMol[U] is anunconditional version of the ShapeMol model proposed in Chen et al. , and it is trained with1000 diffusion steps. ShapeMol [U] is trained with a batch size of 32 on two NVIDIA A100 GPUsfor 500 epochs. Unlike ShapeMol, we do not concatenate the molecular surface embedding of theligands to the features. For the shape-conditioned generation with position correction (ShapeMol+g),we follow the scheme proposed in Chen et al. . It provides further guidance to the conditionalgeneration by sampling 20 query points from a Gaussian distribution centred around every atom inthe reference ligand. The position correction adjusts the coordinates of the predicted atom positionsduring every generation step by pushing the coordinates close to the query points as follows:",
  "zn(x,Q)d(x, z)/n > ,(24)": "where d(x, z) is the Euclidean distance, n(x, Q) is the set of n nearest neighbors of x in Q and > 0 is a distance threshold. We follow the implementation of Chen et al. for the positioncorrection method by setting = 0.2 and only guiding during the first 700 denoising steps. For the shape-conditioned generation with UniGuide, we extract the mesh of the condition ligandusing the Open Drug Discovery Toolkit , which is available under the BSD 3-Clause revisedLicense. The query points we use for guidance are 512 points sampled uniformly on the mesh surface.For the evaluation, we measure the shape similarity SimS as the volume overlap between the alignedgenerated ligand and the condition ligand. For the alignment, we utilise the ShaEP tool .",
  "D.2Additional results": "For completeness, we report additional quantitative evaluation of the generated ligands propertiesin Tab. 4. We also provide further qualitative results of the generated ligands for the LBDD task in. UniGuide generates ligands with better shape similarity to the reference ligands compared tothe conditional model ShapeMol with the position correction technique.",
  "UniGuide (ShapeMol)99.0%100%0.7500.641 0.1072.002 1.3744.982 0.152UniGuide+ EDM99.8%99.99%0.7420.636 0.0881.833 1.2214.994 0.082": ": Examples of the ligands generated by ShapeMol, Pos-Correct and UniGuide. Pos-Correctis the position correction technique proposed by Chen et al. . Both Pos-Correct and UniGuide arecombined with the unconditionally trained model ShapeMol [U]. We plot the reference ligand as wellas the generated ligands with their shapes. : Comparison of UniGuide with validity guidance for shape-based generation. We highlightthe ratio metric as the most critical indicator, reflecting the balance between shape similarity andgraph dissimilarity.",
  "D.3Guidance parameters": "For the LBDD task, the guidance strength S is weighted by an exponentially decreasing functiontt . For the guided generation using the unconditional ShapeMol [U] model under the UniGuideframework, we define a scale scheduler that increases with an exponent of 1.01 and weight it withtt and guide from the diffusion step 1000 to the diffusion step 200. For the guided generationusing the EDM model, we use a linear scale function that increases from 5 to 15. The guidance isapplied from the diffusion step 920 to the last timestep 1.",
  "iixt yi22": "This gradient formulation is quite similar (up to the weighting) to UniGuides special case S = Z,as it computes an L2 loss on a given conformation ({yi}), see Eq. (18), meaning that it does notgeneralise to arbitrary geometric conditions. We emphasise that UniGuide is more broadly applicable because it separates surface computationfrom gradient computation, offering two key benefits. First, since the condition map does not requiredifferentiability, there is greater flexibility in computing surface points. Second, the precise geometricintuition behind the condition map makes it easier to adapt to new scenarios, as demonstrated by ourapplication to generating density-guided molecules. For the empirical comparison, we selected the hyperparameters and in the surface loss computationto achieve a high DICE score between the implicitly defined surface and the meshes UniGuide utilisesfor LBDD ( = 1, = 2, DICE > 0.8). Our surface calculations use the Open Drug DiscoveryToolkit (ODDT), which assigns specific radii to individual atom types and employs the marchingcubes algorithm to generate meshes . We performed several runs around the above-specified hyperparameter configuration. The runs per-formed similarly, and we report the best result in Tab. 5. Although validity guidance for LBDD yieldslow graph similarity, the shape similarity remains suboptimal compared to UniGuide. Additionally,we frequently encounter numerical instability when computing the guidance term, an issue not presentwith UniGuides formulation of LBDD. One possible explanation for this numerical instability is thatthe surface is defined implicitly, unlike UniGuide where it is explicitly defined. The explicit definitionin UniGuide allows for relating the gradient updates directly to the surface, as shown in Eq. (21).",
  "EStructure-based drug design": "Algorithm 2: Sampling algorithm to generate a ligand conditioned on a protein pocket zP using theunconditional joint model (zt, t), where zt = [zMt , zPt ], that models the distribution P(zM, zP).The guidance signal is controlled via the guidance strength S. Note that samples from the generativeprocess p(zt1|zt) are assumed to be CoM-free.",
  "E.2Ligand-protein generative joint model": "SBDD aims to generate a ligand given a protein pocket: p(zM | zPtest, t). We adopt DiffSBDD, an unconditional joint diffusion model that approximates the joint distribution p(zMdata, zPdata) ofgenerating ligand-protein pairs, where the noise predictor (zMt , zPt , t) is parametrised by EGNN.DiffSBDD is available under the MIT License. To process ligand and pocket nodes with a singleGNN, atom types and residue types are embedded jointly. Atom and residue features are then decodedseparately using atom decoder and residue decoder to M (zMt , zPt , t) and P (zMt , zPt , t) . For the unconditional sampling with the joint model, the number of ligand and pocket nodes issampled from the joint node distribution p(N M, N P), measured across a training set of (M, P)pairs. During the modified generative process with the inpainting-inspired technique or with UniGuidethe number of pocket nodes is set to be equal to the number of nodes in Ptest, while the size of theligand is generated from a conditional distribution p(N M | N P). Since this sampling procedureleads to ligands that are much smaller compared to the reference ligands found in the test set, themean size of sampled ligands is increased by 10 for Binding MOAD and 5 for CrossDocked duringligand generation . We utilize the unconditional base models from Schneuing et al. , whichare trained on either the C or full-atom context from the Binding MOAD or CrossDocked datasets.However, we retrain the DiffSBDD model specifically on the full-atom context of the CrossDockeddata, as we were unable to reproduce the reported results in this configuration from Schneuing et al.. We find that contrary to what is reported in Schneuing et al. , the model converges earlyand does not need a full 1000 epochs to fully train. We employ this checkpoint to evaluate both theDiffSBDD inpainting-inspired approach as well as UniGuide. We train the model on four NVIDIAA100 GPU with a batch size of 2. 8 training epochs take approximately 24 hours.",
  "EDGES (POCKET-POCKET)< 5 < 5 < 8 < 4": "Representing ligands and proteins as graphsProteins consist of amino acids, where every aminoacid is a set of amino (NH), carboxyl (CO), -carbon atom and a side chain (R) that is specific toevery amino acid type . The C-representation of a protein pocket is a residue-level graph, inwhich the node features of the protein are represented as one-hot encodings of the amino acid type.The full-atom representation of the receptor is an atom-level graph and represents the full context ofthe protein pocket. Details on processed graphs of the join model p(zM, zP) are provided in Tab. 6.We refer the reader to Schneuing et al. for more information on the hyperparameters of the jointmodel.",
  "E.3Further Comparison to DiffSBDD": "In addition to Tab. 2, we follow the experimental setup as utilised in Schneuing et al. tocompare UniGuideto DiffSBDD, which uses the same base model, in particular. In Tab. 8, wefurther investigate the advantages of using self-guidance in combinations with UniGuide over boththe conditional DiffSBDD model (DiffSBDD-cond) as well as the inpainting-inspired technique : Quantitative comparison of generated ligands for target pockets from the CrossDocked andBinding MOAD test sets. Results taken from Schneuing et al. are indicated with (). We reportmean and standard deviation and highlight the best diffusion-based approach in bold.",
  "Test Set6.865 2.35-0.476 0.200.728 0.144.340 1.14--": "3D-SBDD 5.888 1.917.289 2.340.502 0.170.675 0.144.787 0.510.742 0.09-Pocket2Mol 7.058 2.808.712 3.180.572 0.160.752 0.124.936 0.270.735 0.15-Graph-BP 4.719 4.037.165 1.400.502 0.120.307 0.094.883 0.370.844 0.01- TargetDiff 7.318 2.479.669 2.550.483 0.200.584 0.134.594 0.830.718 0.090.000 0.00DiffSBDD-cond6.950 2.069.120 2.160.469 0.210.578 0.134.562 0.890.728 0.070.000 0.00DiffSBDD7.216 2.549.490 2.000.571 0.190.639 0.144.808 0.500.707 0.090.045 0.01UniGuide7.320 2.279.514 2.040.571 0.190.638 0.144.822 0.470.705 0.080.047 0.01",
  "Graph-BP 4.843 2.246.629 0.950.512 0.110.310 0.094.945 0.270.826 0.010.000 0.00": "DiffSBDD-cond7.172 1.889.174 2.130.430 0.200.564 0.124.526 0.800.711 0.080.000 0.00DiffSBDD7.263 4.199.776 2.250.546 0.210.618 0.124.777 0.540.740 0.0553 31UniGuide7.661 2.999.864 2.130.556 0.200.605 0.124.799 0.500.723 0.0555 31 (DiffSBDD). UniGuide reliably achieves superior VINA Dock scores compared to both DiffSBDDmodels and performs competitively with the conditional TargetDiff model. In App. E.4 and App. E.5,we expand on this experimental comparison with further analysis of the effects of Resampling as wellas the guidance strength.",
  "E.4Resampling": "Inpainting is introduced for diffusion models to condition outputs with fixed parts and canbe applied for structure-based molecular tasks. Given a model that generates (zMt , zPt ) pairs atdenoising step t, the protein pocket Pt is replaced with the noised representation of protein contextzPt . This noised representation can be obtained through the forward process of diffusion modelsas specified in Eq. (2). However, the direct application of this method leads to locally harmonisedsamples that struggle to incorporate the global context . In order to effectively harmonise thegenerated information during the entire generative process, Lugmayr et al. propose a techniquethey call Resampling. This modifies the reverse Markov chain by moving back and forth in thediffusion process to enable the model to better incorporate the replaced components. Schneuing et al. propose to use the same resampling technique to harmonise the replaced proteincontext with the ligand, since the replaced receptor is sampled independently of the ligand. Duringresampling, each latent representation is repeatedly diffused back and forth before advancing tothe next time step. We found that resampling further improves the general performance of theunconditional generation, and thus improves the guided generation as well. We report results for thisin App. E.5, where we evaluate how the unconditional generation of the joint model is improvedacross different metrics with added resampling steps. We follow Schneuing et al. in using thesetting of R = 10 resampling steps and T = 50 timesteps. While DiffSBDD resamples the ligandand the noised target protein pocket, we resample the guided protein pocket and ligand with UniGuide.In general, the concept of resampling can be applied to harmonise the configuration zt with thecondition c.",
  "E.5Guidance parameters": "The guidance scale S controls the strength of the guiding signal, see Eq. (7) and it is weightedby w(t) = (t)t during the generation. We use a constant scale S for structure-based drug designexperiments and evaluate for several guidance scale values in Tab. 9 and Tab. 10 for models trainedon the Binding MOAD dataset with C and full-atom representation respectively. The quantitativeevaluation on the CrossDocked data is shown under Tab. 11 and Tab. 12 with additional metricsreported in Tab. 7. For the generation with the C-models, we generate 100 samples for every testpocket with a batch size of 50. The full generation takes approximately 5 hours for Binding MOADand 6 hours for CrossDocked. For the DiffSBDD model trained on the Binding MOAD fullatompocket data, we use a batch size of 15 for the generation. We use a batch size of 2 to sample with theDiffSBDD model trained on CrossDocked (fullatom). : Results for the Binding MOAD test set with the unconditional DiffSBDD base modeltrained on the C-representation of the pockets combined with UniGuide and the inpainting-inspiredtechnique DiffSBDD . We provide results for varying the guidance scales S during our controlledgeneration. We also report results for the DiffSBDD-cond (C) model trained on the C pockets.",
  "DIFFSBDD-10/50-6.896 3.10-8.962 1.370.547 0.200.578 0.204.754 0.500.709 0.050.007 0.01": "UNIGUIDE1.010/50-6.845 3.68-8.972 1.360.547 0.190.578 0.134.756 0.530.709 0.050.216 0.21UNIGUIDE2.010/50-6.889 3.83-9.018 1.400.547 0.190.577 0.134.756 0.520.707 0.040.279 0.03UNIGUIDE3.010/50-7.050 2.38-9.051 1.390.551 0.180.575 0.144.763 0.500.706 0.040.220 0.01UNIGUIDE4.010/50-7.016 2.93-9.023 1.380.552 0.180.578 0.144.765 0.500.708 0.030.168 0.05UNIGUIDE6.010/50-7.053 2.91-9.067 1.390.550 0.180.579 0.144.761 0.510.703 0.040.146 0.01UNIGUIDE7.010/50-7.076 2.27-9.038 1.380.550 0.180.579 0.144.767 0.500.704 0.040.131 0.01 For all tables, we conduct the experiments both with and without resampling. The VINA Dockscore is measured with QuickVina2 , available under the Apache License, and the chemicalproperties (QED, SA, Lipinski) are measured with RDKit. We note that in all ablation tables wemeasure the VINA Dock score on the processed molecules, following Schneuing et al. , while theVINA Dock score in Tab. 2 is measured following Guan et al. . Both the VINA Dock score andchemical properties improve with additional resampling steps (R = 10, T = 50) for both datasets.Additionally, increasing the guidance scale improves the RMSD with respect to the target protein,and results in generating ligands with an improved binding affinity (lower VINA).",
  "E.7Runtime Comparison": "In Tab. 13, we provide a comparison of the different controlled generation mechanisms regardingtheir runtime. While UniGuide has a higher runtime compared to other conditioning mechanisms,as it has to compute gradients through the diffusion model at inference time, it stays comparable toother mechanisms such as inpainting. : Results for the Binding MOAD test set with the unconditional DiffSBDD base modeltrained on the full-atom context of the pockets combined with UniGuide and the inpainting-inspiredtechnique DiffSBDD . We provide results for varying the guidance scales S during our controlledgeneration. We also report results for the conditional diffusion model DiffSBDD-cond.",
  "DIFFSBDD-10/50-7.263 4.19-9.776 2.250.546 0.210.618 0.124.777 0.540.740 0.0553 31": "UNIGUIDE5.010/50-7.470 2.97-9.621 1.840.563 0.200.605 0.124.807 0.500.723 0.0555 31UNIGUIDE6.010/50-7.570 3.20-9.731 1.900.566 0.200.606 0.124.815 0.480.722 0.0555 31UNIGUIDE7.010/50-7.639 2.39-9.793 2.060.559 0.200.605 0.124.804 0.490.723 0.0554 31UNIGUIDE8.010/50-7.635 2.71-9.821 2.070.558 0.200.605 0.124.804 0.500.720 0.0554 31UNIGUIDE9.010/50-7.661 2.99-9.864 2.130.556 0.200.605 0.124.799 0.500.723 0.0555 31 : Evaluation of the samples generated for the CrossDocked test set using the joint ligand-protein diffusion model trained on the C pocket representation for varying guidance scales S. Thebase model is combined either with the inpaitning-inspired technique (DiffSBDD) or UniGuide. Wefurther report the evaluation of the molecules generated by the conditional model DiffSBDD-condthat is trained on the C pocket representation.",
  "F.1Linker Design": "For the experimental evaluation of the linker design task, we follow Igashov et al. , employthe ZINC dataset and preprocess it following Igashov et al. . That is, 3D conformersare generated from the SMILES strings present in the dataset with RDKit . We fragment thedataset ligands using an MMPA-based algorithm , generating multiple fragment conditionsper molecule. We train an unconditional EDM model for this task as specified in App. C. Forthe evaluation metrics, we follow Igashov et al. . Note that the synthetic accessibility scorecomputation (SA) in Tab. 3 differs from the remaining experimental evaluations. While Igashov et al. report the SA score sSA directly, Schneuing et al. report the SA score as (10 sSA)/9. For the task of linker design, we adjust the condition map as discussed in Sec. 4.2 slightly to includeanchor information, similar in spirit to the DiffLinker model incorporating anchor information .That is, additionally to guiding parts of the molecule to the desired fragment configuration, weadditionally define a cuboids surface that is defined from the specified anchor atoms. We can thenutilise this surface condition CV to guide the linker atoms in accordance with Eq. (21). Additionally,we can expand this surface based on the linker size to ensure chemical validity of the generated linker.This condition map highlights the flexibility of UniGuide condition maps in various tasks, especiallythrough the combination of two definitions of the condition map. For the experimental evaluation, wesample the size of the linker nodes uniformly in accordance with Igashov et al. and compare tothe DiffLinker model without an external network to predict the linker size. Note, however, that alsothe unconditional EDM model combined with UniGuide can be adapted to include such predictors. : Results for the CrossDocked test set with the joint model trained on the full-atom pocketrepresentation of the pocket for varying guidance scales S. The unconditional model is eithercontrolled by the inpainting-inspired technique (DiffSBDD) or UniGuide.",
  "DIFFSBDD-10/50-7.216 2.54-9.490 2.000.571 0.190.639 0.144.808 0.500.707 0.090.045 0.01": "UNIGUIDE6.010/50-7.295 2.22-9.441 1.950.574 0.190.641 0.144.825 0.470.706 0.080.047 0.01UNIGUIDE7.010/50-7.320 2.27-9.514 2.040.571 0.190.638 0.144.822 0.470.705 0.080.047 0.01UNIGUIDE8.010/50-7.298 2.21-9.460 2.010.568 0.190.641 0.144.818 0.470.703 0.090.048 0.01UNIGUIDE9.010/50-7.265 2.45-9.495 2.050.577 0.190.640 0.144.821 0.470.706 0.080.049 0.01 : We evaluate the runtime of UniGuide and compare it to DiffSBDD-cond and DiffSBDDfrom Schneuing et al. . We report the average time (in seconds) to generate 100 ligands perpocket for the CrossDocked (C), Binding Moad (C) and Binding Moad (fullatom).",
  "F.2General Fragment Conditions": "To assess the performance of UniGuide for the task of FBDD, we create an experimental setup withthe goal of generating ligands conditioned on desired fragments roughly following . We select10 random protein targets from the Binding MOAD dataset and decompose their correspondingreference ligands using an MMPA-based algorithm . This decomposition results in a setof 40 different scenarios, including separated fragments we want to link, a fragment to grow orsmall functional groups to perform scaffolding. For every set of fixed fragments, we aim to guidethe unconditional generation of ligands towards the generation of a ligand containing the desiredfragments. As the protein is not the target of the guidance, we employ the DiffSBDD-cond model,which is conditionally trained on the (C)-representation of the protein pocket. For every set of fixedfragments, we generate 100 ligands and use a constant guidance scale of 8. We provide quantitative results for the task of fragment-based drug design in Tab. 15. On the onehand, the task requires the desired fragments to be present in the generated molecule. Thus, wemeasure the success rate of recovery (Hit Ratio) and the RMSD between the generated fragments anddesired fragments. On the other hand, given that the target fragments are met in the generated ligand,the generation has to achieve favourable chemical properties, high binding affinity, as well as highdiversity within the set of generated ligands and low similarity to the reference ligand. As the Inpaintmechanism enforces the fragment during generation more strictly, it is able to achieve a better HitRatio and RMSD. Nevertheless, UniGuide achieves competitive results but also better VINA dockingscores, better properties, and lower similarity compared to the reference ligand. The FBDD task puts a hard constraint on the generated ligands, namely that a set of desired fragmentshas to be present in the generated ligand. However, neither DiffSBDD nor UniGuide can guaranteethat the condition fragments are present in the generated samples.",
  ": Examples of the generated fragment conditioned ligands": ": Quantitative comparison between DiffSBDD and UniGuide for the FBDD task on theBinding MOAD (C) dataset. As the condition in this FBDD scenario is a hard constraint that entailsthe condition to be exactly present in the generation, we add a post-hoc step for both methods wherewe replace the inpainted or guided parts with the exact condition atoms. We report mean and standarddeviation and highlight the best method in bold.",
  "GAtom densities in 3D space": "Similar to the guidance by the volume enclosed by the molecular surface, UniGuide allows to guidetowards multiple point clouds simultaneously. A natural extension of LBDD would be to harnessatom densities as described in Zaucha et al. . Such a setting combines aspects of LBDD andSBDD as it provides conditions also on the feature space, yet the source can only be represented bypoint clouds. In particular, we anticipate UniGuide to be useful in scenarios where explicit information aboutadvantageous features of the ligand is provided in the form of 3D densities. Examples of this includea) volumetric densities that indicate beneficial placement of certain atom types, such as oxygen atoms or b) pharmacophore-like retrieval of advantageous positions for aromatic rings, as utilised ine.g. Zhu et al. . On a technical level, this setting assumes that instead of a reference ligandsstructure, we only have access to (multiple) atom type densities that indicate preferred locations foroptimal interaction with the protein. Additionally, instead of conditioning on a reference ligandsshape, we could condition on a protein pockets surface, which primarily defines exclusion zonesrather than precise atom placement. Adapting UniGuide for such scenarios requires only minor adjustments, as the protein surface cantreated like shapes in standard LBDD, defining an exclusion zone based on proximity to the surface.The atom densities are thresholded to reflect regions of high interest and converted to surfaces usingthe marching cubes algorithm . To also include feature information, we effectively employ amodified condition map similar to Eq. (21) that extends the transformation from the conformation tothe configuration space. Moreover, the number of atoms guided by each density is adjusted based onits volume, reflecting the varying influence of each density, and guidance is only applied if atoms aresufficiently close. We show explorative results for the guided generation of molecules towards desired atom densitiesusing UniGuide in . While our current approach represents a promising first step in tacklingthis task, we acknowledge the potential for further refinement and are eager to explore futureimprovements within the UniGuide framework.",
  "Question: Do the main claims made in the abstract and introduction accurately reflect thepapers contributions and scope?Answer: [Yes]": "Justification: The claims made in the abstract and introduction reflect the papers contributionand scope: Sec. 4 details how UniGuide is readily adaptable to various tasks in drugdesign, attesting to the unification provided by the UniGuide framework. Sec. 5 emphasisesthis aspect through competitive or superior performance across various tasks, even whencompared to task-specific baselines.Guidelines:",
  "The answer NA means that the paper has no limitation while the answer No means thatthe paper has limitations, but those are not discussed in the paper": "The authors are encouraged to create a separate \"Limitations\" section in their paper. The paper should point out any strong assumptions and how robust the results are toviolations of these assumptions (e.g., independence assumptions, noiseless settings,model well-specification, asymptotic approximations only holding locally). The authorsshould reflect on how these assumptions might be violated in practice and what theimplications would be. The authors should reflect on the scope of the claims made, e.g., if the approach wasonly tested on a few datasets or with a few runs. In general, empirical results oftendepend on implicit assumptions, which should be articulated. The authors should reflect on the factors that influence the performance of the approach.For example, a facial recognition algorithm may perform poorly when image resolutionis low or images are taken in low lighting. Or a speech-to-text system might not beused reliably to provide closed captions for online lectures because it fails to handletechnical jargon.",
  "If applicable, the authors should discuss possible limitations of their approach toaddress problems of privacy and fairness": "While the authors might fear that complete honesty about limitations might be used byreviewers as grounds for rejection, a worse outcome might be that reviewers discoverlimitations that arent acknowledged in the paper. The authors should use their bestjudgment and recognize that individual actions in favor of transparency play an impor-tant role in developing norms that preserve the integrity of the community. Reviewerswill be specifically instructed to not penalize honesty concerning limitations.",
  "If the contribution is a dataset and/or model, the authors should describe the steps takento make their results reproducible or verifiable": "Depending on the contribution, reproducibility can be accomplished in various ways.For example, if the contribution is a novel architecture, describing the architecture fullymight suffice, or if the contribution is a specific model and empirical evaluation, it maybe necessary to either make it possible for others to replicate the model with the samedataset, or provide access to the model. In general. releasing code and data is oftenone good way to accomplish this, but reproducibility can also be provided via detailedinstructions for how to replicate the results, access to a hosted model (e.g., in the caseof a large language model), releasing of a model checkpoint, or other means that areappropriate to the research performed. While NeurIPS does not require releasing code, the conference does require all submis-sions to provide some reasonable avenue for reproducibility, which may depend on thenature of the contribution. For example(a) If the contribution is primarily a new algorithm, the paper should make it clear howto reproduce that algorithm.",
  "(b) If the contribution is primarily a new model architecture, the paper should describethe architecture clearly and fully": "(c) If the contribution is a new model (e.g., a large language model), then there shouldeither be a way to access this model for reproducing the results or a way to reproducethe model (e.g., with an open-source dataset or instructions for how to constructthe dataset). (d) We recognize that reproducibility may be tricky in some cases, in which caseauthors are welcome to describe the particular way they provide for reproducibility.In the case of closed-source models, it may be that access to the model is limited insome way (e.g., to registered users), but it should be possible for other researchersto have some path to reproducing or verifying the results.",
  "Guidelines:": "The answer NA means that the paper does not use existing assets. The authors should cite the original paper that produced the code package or dataset. The authors should state which version of the asset is used and, if possible, include aURL. The name of the license (e.g., CC-BY 4.0) should be included for each asset. For scraped data from a particular source (e.g., website), the copyright and terms ofservice of that source should be provided. If assets are released, the license, copyright information, and terms of use in thepackage should be provided. For popular datasets, paperswithcode.com/datasetshas curated licenses for some datasets. Their licensing guide can help determine thelicense of a dataset.",
  ". Broader Impacts": "Question: Does the paper discuss both potential positive societal impacts and negativesocietal impacts of the work performed?Answer: [Yes]Justification: We discuss the broader impact of our work in App. A. We discuss the positivesocietal impacts of the proposed unification and the resulting flexibility of unconditionalmodels to be adapted to various new drug discovery tasks in Sec. 1 and Sec. 6.Guidelines: The answer NA means that there is no societal impact of the work performed. If the authors answer NA or No, they should explain why their work has no societalimpact or why the paper does not address societal impact. Examples of negative societal impacts include potential malicious or unintended uses(e.g., disinformation, generating fake profiles, surveillance), fairness considerations(e.g., deployment of technologies that could make decisions that unfairly impact specificgroups), privacy considerations, and security considerations. The conference expects that many papers will be foundational research and not tiedto particular applications, let alone deployments. However, if there is a direct path toany negative applications, the authors should point it out. For example, it is legitimateto point out that an improvement in the quality of generative models could be used togenerate deepfakes for disinformation. On the other hand, it is not needed to point outthat a generic algorithm for optimizing neural networks could enable people to trainmodels that generate Deepfakes faster. The authors should consider possible harms that could arise when the technology isbeing used as intended and functioning correctly, harms that could arise when thetechnology is being used as intended but gives incorrect results, and harms followingfrom (intentional or unintentional) misuse of the technology. If there are negative societal impacts, the authors could also discuss possible mitigationstrategies (e.g., gated release of models, providing defenses in addition to attacks,mechanisms for monitoring misuse, mechanisms to monitor how a system learns fromfeedback over time, improving the efficiency and accessibility of ML).",
  ". Safeguards": "Question: Does the paper describe safeguards that have been put in place for responsiblerelease of data or models that have a high risk for misuse (e.g., pretrained language models,image generators, or scraped datasets)?Answer: [NA]Justification: The research discussed in this paper does not require safeguards to be put inplace.Guidelines: The answer NA means that the paper poses no such risks. Released models that have a high risk for misuse or dual-use should be released withnecessary safeguards to allow for controlled use of the model, for example by requiringthat users adhere to usage guidelines or restrictions to access the model or implementingsafety filters.",
  "According to the NeurIPS Code of Ethics, workers involved in data collection, curation,or other labor should be paid at least the minimum wage in the country of the datacollector": "15. Institutional Review Board (IRB) Approvals or Equivalent for Research with HumanSubjectsQuestion: Does the paper describe potential risks incurred by study participants, whethersuch risks were disclosed to the subjects, and whether Institutional Review Board (IRB)approvals (or an equivalent approval/review based on the requirements of your country orinstitution) were obtained?Answer: [NA]Justification: This work did not conduct experiments where human subject were involvedand therefore does not require IRB approvals.Guidelines:",
  "The answer NA means that the paper does not involve crowdsourcing nor research withhuman subjects": "Depending on the country in which research is conducted, IRB approval (or equivalent)may be required for any human subjects research. If you obtained IRB approval, youshould clearly state this in the paper. We recognize that the procedures for this may vary significantly between institutionsand locations, and we expect authors to adhere to the NeurIPS Code of Ethics and theguidelines for their institution."
}