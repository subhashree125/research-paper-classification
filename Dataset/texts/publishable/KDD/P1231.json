{
  "ABSTRACT": "Graph Neural Networks (GNNs) have been broadly applied in manyurban applications upon formulating a city as an urban graph whosenodes are urban objects like regions or points of interest. Recently,a few enhanced GNN architectures have been developed to tackleheterophily graphs where connected nodes are dissimilar. How-ever, urban graphs usually can be observed to possess a uniquespatial heterophily property; that is, the dissimilarity of neighborsat different spatial distances can exhibit great diversity. This prop-erty has not been explored, while it often exists. To this end, inthis paper, we propose a metric, named Spatial Diversity Score, toquantitatively measure the spatial heterophily and show how itcan influence the performance of GNNs. Indeed, our experimentalinvestigation clearly shows that existing heterophilic GNNs arestill deficient in handling the urban graph with high spatial diver-sity score. This, in turn, may degrade their effectiveness in urbanapplications. Along this line, we propose a Spatial HeterophilyAware Graph Neural Network (SHGNN), to tackle the spatial diver-sity of heterophily of urban graphs. Based on the key observationthat spatially close neighbors on the urban graph present a moresimilar mode of difference to the central node, we first design arotation-scaling spatial aggregation module, whose core idea is toproperly group the spatially close neighbors and separately processeach group with less diversity inside. Then, a heterophily-sensitivespatial interaction module is designed to adaptively capture the",
  "This work was done when the first author was an intern at Baidu Research under thesupervision of Jingbo Zhou.Corresponding authors": "Permission to make digital or hard copies of all or part of this work for personal orclassroom use is granted without fee provided that copies are not made or distributedfor profit or commercial advantage and that copies bear this notice and the full citationon the first page. Copyrights for components of this work owned by others than theauthor(s) must be honored. Abstracting with credit is permitted. To copy otherwise, orrepublish, to post on servers or to redistribute to lists, requires prior specific permissionand/or a fee. Request permissions from 23, August 610, 2023, Long Beach, CA, USA 2023 Copyright held by the owner/author(s). Publication rights licensed to ACM.ACM ISBN 979-8-4007-0103-0/23/08...$15.00",
  "INTRODUCTION": "Applying Graph Neural Networks (GNNs) in different urban appli-cations has attracted much research attention in the past few years. These studies usually model the city as anurban graph whose nodes are urban objects (e.g., regions or Pointsof Interest (POIs)) and whose edges are physical or social dependen-cies in the urban area (e.g., human mobility and road connection). Upon urban graphs, GNNs with variant architectures areproposed to achieve the classification or regression tasks.Nevertheless, there is a serious limitation of GNNs which hasbeen largely overlooked in previous studies but have attractedincreasing research attention recently: GNNs have an implicit ho-mophily assumption that nodes only with similar features or samelabels are connected together on the graph . Meanwhile,the opposite assumption is heterophily that connected nodes havedissimilar features or labels. In fact, heterophily usually exists in anurban graph as it describes the complex urban system where bothsimilar and dissimilar urban objects (e.g., regions with differentfunctionalities) can correlate with each other in complex manners.Taking the urban graph constructed with human mobility as anexample, the start node and end node of an edge could be home",
  "(a) Direction-aware Partition(b) Distance-aware Partition(c) Spatial Diversity Score(d) Performance on Synthetic Graphs": ": Analysis of spatial heterophily. (a)-(b) illustrate the space partition from two spatial views. (c) shows the spatialdiversity scores calculated on three real-world urban graphs. (d) presents the results of experimental investigation. and workplace, respectively, which are definitely heterophilic. Suchdifference information on the heterophilic urban graph may notbe modeled well by many traditional homophilic GNNs, who tendto generate similar representations for connected nodes . Inthis way, the performance of these homophilic GNN methods onurban graphs may be largely hindered.Our further observation is that urban graphs have a unique Spa-tial Heterophily property. To be specific, we find that the heterophilyon the urban graph often presents a characteristic of spatial diversity.In other words, the difference (or dissimilarity) between the centralnode and its neighbors at different distances or directions exhibitsevident discrepancy, rather than distributed uniformly. Aware ofsuch a characteristic, an attendant question is how to measure thespatial heterophily of the urban graph. There have been variousstudies put forward to investigate the graph homophily and het-erophily from different perspectives, including node homophily, edge homophily and class homophily . But withoutconsidering the spatial position of linking nodes, these metricscannot describe the spatial heterophily on urban graphs.Therefore, in this work, we propose a metric named spatial di-versity score to analyze the spatial heterophily, and investigate itsinfluence on the performance of existing GNN methods on urbangraphs. Firstly, we divide the neighbors on an urban graph intodifferent spatial groups according to their locations (including di-rection and distance), and then the spatial diversity score measuresthe discrepancy between different spatial groups, in terms of theirlabel dissimilarity to the central node. A higher score (close to one)indicates a larger discrepancy between different spatial groups, andthus a higher spatial diversity of heterophily on the urban graph.Yet, it still remains an outstanding challenge for designing pow-erful heterophilic GNN models over an urban graph if its spatialdiversity score is high, where there is a diversity of dissimilaritydistributions between the central node and its neighbors at differ-ent spatial locations. There are some recent studies to improve theGNN architectures to handle the graph heterophily .Most of these methods can only work on a heterophilic graph whenthere is limited difference between nodes. For example, GBKGNN assumes that there are only two different kinds of nodes, andFAGCN assumes that node features have only two differentlevels of frequencies (Note that this limitation is discussed in theirpapers). Following this line, it is hard to model such diverse distri-butions of spatial heterophily on urban graphs. To provide moreevidence, we conduct an experiment on synthetic urban graphswith varying levels of spatial diversity score (details are in Section 3.2). As shown in (d), when the graph presents higher spa-tial diversity score, the performance of these two state-of-the-artheterophilic GNNs, GBKGNN and FAGCN, is far from optimal. Wealso apply the proposed spatial diversity score to analyze three real-world urban graphs under different target tasks in our experiments.As we can see from (c), three urban graphs present differentlevels of spatial heterophily, where one of them can get a very highscore (0.99 on the urban graph in crime prediction task). Thus, itis valuable to develop an effective GNN model that can handle thediverse spatial heterophily of the urban graph.Through our in-depth analysis of spatial heterophily, we observethat the heterophily further exhibits a spatial tendency on urbangraphs, which reveals a promising opportunity for us to tackle suchdiverse heterophily in a divide-and-conquer way. Different fromordinary graphs, nodes on urban graphs should follow ToblersFirst Law of Geography (TFL) . As the fundamental assumptionused in almost all urban analysis, TFL means everything is related toeverything else, but near things are more related than distant things.Obeying TFL, spatially close neighbors on the urban graph presenta more similar mode of difference to the central node, comparedto the distant ones. We also analyze the real-world urban graphin commercial activeness prediction task to visualize such a ten-dency (details are in ). clearly shows that spatiallyclose neighbors present less discrepancy from both the directionand distance view. Thus, if we can properly group the spatiallyclose neighbors together, it is possible to alleviate the diversity ofheterophily inside groups on the urban graph.To this end, we propose a novel Spatial Heterophily Aware GraphNeural Network (SHGNN), to tackle the spatial heterophily onurban graphs, with two specially designed modules. First, we devisea Rotation-Scaling Spatial Aggregation module. Its core idea is toproperly divide the neighbors into different spatial groups accordingto their direction and distance to the central node, and perform aspatial-aware feature aggregation for each group, which serves asthe basis of handling diverse heterophily distributions separately.Then, a Heterophily-Sensitive Spatial Interaction module with twolearnable kernel functions is designed to capture the commonalityand discrepancy in the neighborhood, and adaptively determinewhat and how much difference information the central node needs.It acts between the central node and neighbors in different groupsto manage the spatial diversity of heterophily on the urban graph.The contribution of this paper is summarized as follows: To the best of our knowledge, we are the first to investigate thespatial heterophily of urban graphs. We design a metric named",
  "PRELIMINARIES": "In this section, we first introduce the basic concepts of the urbangraph, then clarify the goal of our work. The frequently used nota-tions are summarized in in Appendix.Urban Graphs. Let G(V, E, ) denote an urban graph, whereV = {1, ..., } denotes a set of nodes representing a kind of urbanentity, E denotes the edge set indicating one type of relation amongnodes in the urban scenario, and N () = { |(, ) E} is theneighborhood of node . R denotes the feature matrix, inwhich the -th row is the -dimensional node features of obtainedfrom the urban data. Different instantiations of node set and edgeset will form different urban graphs, such as: (1) Mobility Graphwith regions as nodes and human flows as edges. The node featurescan be some region attributes such as the distribution of POI insidethe region; (2) Road Network where the node set is formed byroad sections, and the edges denote the connectivity between them.The node features can be the structural information of a section,such as the number of branches and lanes.Problem Formulation. Given an urban graph, our goal is to designa GNN model, that considers and alleviates the spatial heterophily,to learn the node representation : ( |G) , where denotesthe representation vector of node . The model will be trainedin an end-to-end manner in different downstream tasks.",
  "SPATIAL HETEROPHILY": "In this section, an analysis of spatial heterophily on urban graphsis provided. We first introduce our metric to measure the spatialheterophily (.1). Then, .2 gives an experimentalinvestigation on synthetic graphs. It not only demonstrates theimportance for GNNs to consider the spatial heterophily on urbangraphs, but also suggests a promising way to tackle this challenge.",
  "Spatial Diversity of Heterophily": "To describe the spatial diversity of heterophily on urban graphs,we design a metric named spatial diversity score. Typically, thegraph heterophily is measured by the label dissimilarity betweenthe central node and its neighbors (e.g., ). Following this line,our spatial diversity score aims to further assess the discrepancybetween neighbors at different spatial locations, in terms of the dis-tributions of their label dissimilarity to the central node. Briefly, wefirst divide the neighborhood into different spatial groups accord-ing to their spatial locations. Then, we can measure spatial groupsdiscrepancy by calculating the Wasserstein distance between theirlabel dissimilarity distributions, and the metric is further definedas the ratio of nodes with high discrepancy. 3.1.1Dual-View Space Partition. To distinguish the spatial loca-tion of neighbors and form different spatial groups, we first parti-tion the geographic space into several non-overlap subspaces, andeach neighbor of the central node can be assigned to the groupcorresponding to the subspace it locates in. Note that the spatialheterophily can both present in different directions and distances,thus we propose to perform space partition from both two views.Direction-Aware Partition. Given the central node on an ur-ban graph, we evenly partition the geographic space centered by itinto ten direction sectors S = { | = 0, 1, ..., 9}. Correspondingly,nodes in the neighborhood N () will be divided into the sectorthey locate in. Neighbors belonging to the same sector are rede-fined as the direction-aware neighborhood {N () | = 0, 1, ..., 9},where 9=0 N () = N (). In this way, the direction-awareneighborhoods can be regarded as different spatial groups associ-ated with different spatial relations to the central node. We willthen calculate the discrepancy between different spatial groups.(a) illustrates such a sector partition.Distance-Aware Partition. As illustrated in (b), wealso divide the neighbors based on their distance to the centralnode. To be specific, we first determine the distance range of theneighborhood on an urban graph, by making a statistic of the dis-tance distribution between connected nodes. Note that we considerthe 90% percentile of this distribution as the maximum distance ofthe neighborhood on the graph. This is based on the observationthat the distance distribution often presents a long tail property,and such a distance cut-off can avoid interference from extremelydistant outliers. And then, the distance range is evenly split into tenbuckets, which results in distance rings R = { | = 0, 1, ..., 9}. Sim-ilarly, the original neighborhood N () can be divided into these tendistance-aware neighborhoods {N () | = 0, 1, ..., 9} as anotherview of spatial groups, where we also have 9=0 N () = N (). 3.1.2Spatial Diversity Score. After the neighborhood partition,our goal is to further define the spatial diversity score by measuringthe discrepancy between different spatial groups, based on theirdistribution distance of label dissimilarity to the central node.First of all, we define spatial groups label dissimilarity distri-bution to the central node. For a node classification task with Cclasses, within a spatial group, this distribution is calculated as theratio of neighbors belonging to each class (different to the centralnodes). Taking the direction view as an example, for the centralnode , the label dissimilarity distribution of is formally definedas = [ ,0 , ,1 , ... , ,| C1|] with:",
  "N ( )1(, = 1) |N ()|1,(1)": "where = 0, 1, ..., |C 1|, 1() is the indicator function, and iss one-hot label vector whose -th value is denoted by ,.In addition, to improve the generality of this metric to more urbanapplications (e.g., regression tasks), we also extend the definition oflabel dissimilarity distribution above to the node regression task. Tobe specific, we first make a statistic of the label difference betweenconnected nodes on the whole graph Y = {( ) | (, ) E},and calculate the deciles {1, 2,, ..., 9} of this distribution. Thesenine deciles can determine ten buckets (intervals), which will beused for the discretization of continuous label difference value, to",
  ": Illustration of spatial tendency in the distance view (a) and direction view (b)": "obtain a similar form of label dissimilarity as the node classificationtask. Hence, still for the spatial group N () in sector , its labeldissimilarity distribution will be calculated as the ratio of neighborsmapped into different buckets, according to their discretized labeldifference to the central node, which can be also formulized as:= [ ,0 , ,1 , ... , ,9], with the -th element computed by:",
  "N ( )1( < +1) |N ()|1,(2)": "where = 0, 1, ..., 9. The 0 and 10 are used to denote the minimumand maximum of the label difference distribution on the wholegraph, respectively (i.e., 0 = min( Y) and 10 = max( Y)).Next, the discrepancy between different spatial groups can bedefined by measuring the distance between their label dissimilaritydistributions. Following a recent study on the graph heterophily, we adopt Wasserstein distance (WD) to measure the distribu-tion distance between two spatial groups. Formally, consider twospatial groups N () and N () in sector and of node ,the discrepancy between them is defined as:",
  "(,,) = ( , ),(3)": "where (, ) denotes the Wasserstein distance between two dis-tributions, which can be approximately calculated by the Sinkhorniteration algorithm .With such a measurement, we can finally define the spatial di-versity score to describe the diverse spatial heterophily of an urbangraph. This metric can be computed based on the ratio of nodeswith high discrepancy among different spatial groups:",
  "V1(max (,,) 1),(4)": "where max (,,) 1 with , = 0, 1, ..., 9 indicatesthat there are at least two sectors being discrepant in terms of theirlabel dissimilarity distributions to the central node . In this way,the score will get higher if there are more nodes whose spatialgroups present high discrepancy on the urban graph. Similarly, wecan also define the score in the distance view, which measuresthe discrepancy between spatial groups formed by different ringsin R, with different distances to the central node:",
  "Experimental Investigation": "Next, we conduct an experimental investigation on synthetic urbangraphs to illustrate the importance of considering the diverse spatialheterophily on the urban graph. Specifically, we test the perfor-mance of several GNN models on a series of synthetic urban graphswith increasing spatial diversity of the heterophily. We generate10 graphs containing 5000 nodes with 10-dimensional randomlygenerated feature vectors. For each node, we build 50 edges andassume that these neighbors locate at 10 distance rings from nearto far around the central node. To increase the spatial diversity ofheterophily from G1 to G10, we gradually enlarge the discrepancyof label dissimilarity distributions between neighbors in differentdistance rings. Specifically, in graph G, we evenly divide the nodeset into subsets V = =1 V,, where the labels of nodes in V,are sampled from the Gaussian distribution N (10, 1). Then, the50 neighbors connected to the node in V, are randomly selectedfrom one of subsets {V,}|= by an equal probability 1/( + 1).Besides, we let neighbors spatial distance be consistent with theirlabel difference to the central node (i.e., neighbors with smallerdifferences locates in the closer distance ring). In this way, these 10graphs will have increasing spatial diversity scores . Meanwhile,neighbors in the same distance ring have less discrepancy.(d) shows the node regression error of GCN and twostate-of-the-art heterophic GNNs (FAGCN and GBKGNN ) on10 synthetic graphs. As expected, GCN gets the worst performance,since it proved unsuitable for heterophily graphs in most cases .For two heterophic GNNs, despite less error than GCN, their per-formance is still far from optimal when the spatial diversity scoreincreases. This is because they only model limited dissimilaritybetween nodes (e.g., two levels of frequencies or two classes ofnodes ), without considering diverse dissimilarity distributions.However, if the model separately processes neighbors in each dis-tance ring whose differences to the central node are more similar,(as our SHGNN did), it can always achieve satisfactory performance.Thus, its reasonable to consider whether we can tackle the diversespatial heterophily, by properly grouping together the neighborswith less discrepancy on the urban graph.",
  "METHODOLOGY": "In this section, we first present that the heterophily on urban graphsoften exhibits a spatial tendency: spatially close neighbors havemore similar heterophily distributions than distant ones, whichobeys TFL. This characteristic gives rise to the solution that we canproperly divide neighbors according to their spatial locations, toachieve grouping neighbors with less discrepancy together. Then,we introduce our proposed SHGNN that leverages such a spatialtendency to tackle the spatial heterophily of urban graphs.Spatial Tendency. In addition to the presence of a discrepancybetween different spatial groups (discussed in .1), our in-depth investigation of spatial heterophily further reveals that such adiscrepancy shows a spatial tendency on urban graphs. Specifically,we observe that the discrepancy between two spatially close groupsis smaller, compared to two distant groups. We conduct a dataanalysis to visually present such a tendency. shows thepair-wise discrepancy of label dissimilarity distributions betweenany two spatial groups, which is computed based on real-worldhuman mobility and regional commercial activeness data. In (a), for the spatial group formed by distance ring , we can findthat its discrepancy with other rings is highly correlated totheir spatial distance (i.e., the discrepancy gets higher when ismore distant to ). For example, the close ring pair (0,1) are lessdiscrepant than the distant pair (0,9). A similar spatial tendencycan also be observed from the direction view. As shown in (b), in most cases, the discrepancy will increase along with theincluded angle between sectors. Taking sector 0 as an example, itsdiscrepancy with 1 9 increases first and then decreases, whichis roughly in sync with the change of their included angles. Inother words, a sector is more likely to be discrepant to anotherdistant sector (e.g., (1,6)) than a nearby one (e.g., (1,2)). Thischaracteristic motivates us to address the diverse spatial heterophilyon urban graphs, by properly grouping spatially close neighborsand separately processing each group with less discrepancy inside.To this end, we propose a novel GNN architecture named SHGNN,which is illustrated in and 4. Our model consists of twocomponents: Rotation-Scaling Spatial Aggregation (see .1)and Heterophily-Sensitive Spatial Interaction (see .2).",
  "Rotation-Scaling Spatial Aggregation": "This component aims to properly group spatially close neighborsand alleviate the diversity of heterophily inside groups in the mes-sage passing process. In general, we first divide neighbors accordingto their relative positions to the central node. Then, the featureaggregation is performed in each spatial group separately. 4.1.1Rotation-Scaling Dual-View Partition. Following the neigh-borhood partition in .1.1, we also partition the geographicspace into non-overlap subspaces, and neighbors located at thesame subspace are then grouped together. Note that there are twomajor differences between the space partition performed in thiscomponent and that in .1.1. First, we apply a more generalpartition with a variable number of subspaces. Second, we intro-duce a rotation-scaling multi-head partition strategy to model theneighbors spatial location in a more comprehensive way.To be specific, in the direction view, we evenly partition the spaceinto a set of sectors S = { | = 0, 1, ..., 1}, where denotes",
  ": Illustration of Rotation-scaling Partition": "the number of partitioned sectors, which can be appropriately setfor different datasets. Nodes in each direction-aware neighborhoodN() of sector are grouped together, which we still call spatialgroup. In the distance view, the space will be partitioned into distance rings R = { | = 0, 1, ..., 1}, which is resulted from apredefined distance bucket (e.g., < 1, 1 2, and > 2). Notethat the central node itself does not belong to any sector or ring,we regard it as an additional group N() = N() = {}. Rotation-Scaling Multi-Head Partition. In view of the special casethat a part of neighbors may locate at the boundary between twosubspaces, we further propose a multi-head partition strategy tosimultaneously perform multiple partitions at each view, wheredifferent heads can complement each other. For example, as shownin (a), the orange node 4 locates at the boundary betweensectors 0 and 1, which indicates that the spatial relation of theneighborhood is still inadequately excavated by the single direction-based partition. A similar situation can be found in the partition ofdistance rings, such as the node 4 in (b).To overcome this limitation, we extend our partition strategyby devising two operations, which are sector rotation and ring scal-ing, to achieve multiple space partitions for capturing the diversespatial relations comprehensively. Specifically, as illustrated in Fig-ure 3(a) and (c), for the originally partitioned direction sectors, weturn the sector boundary a certain angle (e.g., 45 degrees) to deriveanother set of sectors, then the neighbors can be correspondinglyreassigned in these new sectors and form a different set of direction-aware neighborhoods. Thus, we update the denotation of sectorsas S ={ | = 0, 1, ...,}, and that of direction-aware neighbor-hoods as {N () | = 0, 1, ...,}, where = 1, 2, ..., denotesthe -th head partition among total heads. Similarly, from thedistance view, we scale the boundary of the original distance ringsto obtain the supplemental partition, which is shown in (b)and (d). The denotations are updated as R ={ | = 0, 1, ..., }and {N () | = 0, 1, ..., } for rings and distance-aware neigh-borhoods, where = 1, 2, ..., . In this way, different heads ofpartitions model the spatial relation between neighbors and thecentral node complementarily, and thus we can avoid the impropergrouping under a single partition. 4.1.2Spatial-Aware Aggregation. After the multi-head partitionfrom two spatial perspectives, we collect messages from neighborsto the central node. Rather than mixing the messages (e.g., throughaveraging) that most of the GNNs follow , our model performsa group-wise aggregation to handle different spatial groups withdiverse heterophily. An illustration is shown in (a).",
  "&,)": ": The architecture of SHGNN. We only detailedly present the operation under sector partition in the illustration of twokernel functions and the attentive component selection. The same operation is also performed under ring partition. Formally, taking the direction view as an example, with the set ofdirection-aware neighborhoods (spatial groups) under the -headpartition {N () | = 0, 1, ...,}, we use graph convolution to respectively aggregate the features of nodes in each neighbor-hood N () with the normalization by degree:",
  "Heterophily-Sensitive Spatial Interaction": "After the group-wise feature aggregation, SHGNN further capturesthe diverse spatial heterophily in different spatial groups on theurban graph. In detail, we devise two learnable kernel functionsto first respectively capture the commonality and discrepancy be-tween the central node and each spatial group. Then, an attentivegate is jointly learned to adaptively determine the ratio of two com-ponents that should be propagated to the central node. Additionally,as indicated by the analysis of spatial tendency in , the dis-crepancy of heterophily distributions varies along with the distancebetween two spatial groups, we further consider such characteris-tics by allowing the kernel functions to act between groups, which encourages the propagation of common and discrepant informationamong them. Since we view the central node as an additional group,this process can be regarded as an interaction among every twogroups. For simplicity, we omit the index and of layer and headin the following discussion. Commonality Kernel Function. Given the fact that different sec-tors / rings all belong to the neighborhood of the central node, theymay share some common knowledge that can probably enhance therepresentation of each other. Thus, we first design a commonalitykernel function to capture such information among them.Formally, taking the direction view as an example, with therepresentation {, | = 0, 1, ...,} of sectors centered by ,the kernel function K (, ) that models the commonality degreebetween sector and (including itself) is defined as:",
  "K (,, ,) = <,, , (,, ,, ) >,(11)": "where ,and ,denote two transformations that learn to ex-tract the difference of sector compared to sector . Accordingto , the kernel function K (,, ,) can be regarded as cal-culating the dissimilarity degree between two inputs, which tendsto be higher when and are more dissimilar. Subsequently, ourmodel facilitates each sector to be aware of the helpful differenceinformation from others with this measurement of discrepancy:",
  "=0 (K (,, , )) .(13)": "Similarly, we utilize an analogous kernel function, which is denotedas K (,) with parameters ,and ,to capture such discrep-ancy at the distance view and derive the ring representation ,aware of the diverse distributions of spatial heterophily. Attentive Component Selection. With these two kernel functions,we can exploit both the common knowledge and diverse discrep-ancy information between the central node and neighbors in differ-ent groups. However, different nodes may possess varying levels ofspatial heterophily in various applications. Thus, SHGNN learns toderive a gate that adaptively determines the ratio of common anddifference information in an end-to-end manner.Specifically, for each central node , we concatenate both thecommonality and discrepancy components of all sectors, to derivea scalar with a transformation:",
  ", = , + (1 ) , .(15)": "In the same way, we learn to derive the gate that determines theratio in each rings final representation , .After the propagation among spatial groups (including the cen-tral node), different groups can contain diverse discrepancy infor-mation in the neighborhood, which is vital to the heterophilic urbangraph. We then integrate this group-wise representation by con-catenation (instead of summation, to avoid the mixing of diversedistributions of spatial heterophily) to obtain the global representa-tion of two views. Since we adopt the multi-head partition strategy,a following concatenation is used to combine different heads ateach view. The above two processes can be jointly expressed as:",
  "Prediction and Optimization": "Consistent with general GNNs, we use the -layer output activatedby ReLU function =(()) as the node representation to make aprediction in different downstream tasks, and optimize the model bythe appropriate loss function: L( ( ) , ). In node regressiontasks, () is the linear regressor, R denotes the ground truthof labeled nodes, and L can be L2 loss. While for node classificationtasks, () performs the logistic regression, {0, 1}C is a one-hot label vector of C classes, and L can be cross entropy loss.",
  "Experiment Settings": "5.1.1Tasks and Data Description. We first briefly introduce thethree datasets corresponding to three different tasks, and details ofhow to build each dataset are described in Appendix A.1. summarizes the statistical information of the three datasets.Commercial Activeness Prediction (CAP) is a node regres-sion task on a mobility graph. Similar to , we use the numberof comments to POIs in each region as the indicator of regionalcommercial activeness. To form the dataset of this task, we collectthe following urban data in Shenzhen city in China from BaiduMaps, including POI data and satellite images in September 2019 toconstruct region features, the daily human flow data from July 2019to September 2019 for building the edge set of the urban graph, andthe number of regional POI comments from June 2019 to April 2020which is regarded as the ground truth.Crime Prediction (CP) is also a node regression task on themobility graph. We collect the real-world dataset of New York Cityfrom NYC open data website1 for this task. The dataset contains180 regions in Manhattan, with the POI data and crime numberin each region, as well as taxi trips between regions . Weconstruct node features from POIs. Taxi trips are used to build the",
  "MethodsRMSE MAE R2 RMSE MAE R2 AUC F1-score": "GCN8.354 0.020*5.018 0.028*0.388 0.003*156.1 1.312*114.5 1.005*0.082 0.015*0.634 0.002*0.229 0.003*GAT8.952 0.153*5.134 0.099*0.298 0.023*166.8 5.750*127.1 4.359*-0.040 0.071*0.613 0.006*0.213 0.008Mixhop8.168 0.038*4.981 0.010*0.415 0.005*147.6 0.576*109.0 0.398*0.179 0.006*0.636 0.003*0.229 0.005*FAGCN8.327 0.018*5.063 0.031*0.392 0.002*150.9 3.618*108.1 2.1790.142 0.041*0.632 0.004*0.228 0.009NLGCN8.495 0.108*4.883 0.053*0.367 0.016*151.7 4.496*110.2 3.5570.133 0.050*0.626 0.003*0.224 0.004*GBKGNN8.490 0.017*5.004 0.0740.368 0.002*133.6 4.09598.28 3.7920.327 0.0410.626 0.011*0.225 0.013GPRGNN8.139 0.0164.975 0.025*0.419 0.002152.4 0.338*107.0 0.319*0.126 0.003*0.635 0.003*0.226 0.004*PRIM8.928 0.144*5.186 0.086*0.301 0.022*151.7 6.243*118.6 4.320*0.131 0.070*0.615 0.008*0.210 0.005*SAGNN8.843 0.068*5.305 0.057*0.315 0.010*142.2 2.451*108.6 1.360*0.238 0.026*0.630 0.006*0.216 0.008*TASK-S8.360 0.068*4.875 0.028*0.387 0.010*138.8 2.619*100.4 0.9450.274 0.027*0.638 0.0120.240 0.008SHGNN7.605 0.1314.485 0.0560.493 0.017118.7 4.13591.16 2.7540.469 0.0360.684 0.0040.263 0.003",
  ": Performance comparison between SHGNN and its variants on three tasks": "urban graph, where we only keep the 20 most important edges foreach region w.r.t. the number of trip records.Dangerous Road Section Detection (DRSD) is a node clas-sification task performed on the road network. In this work, thedangerous section is defined as the road section with a high in-cidence of traffic accidents. We build a real-world dataset in LosAngeles based on the road network data from OSMnx Street Net-works in Harvard Dataverse2 and the traffic accident records inDecember 2021 from Kaggle dataset website3. First, we make statis-tics of the number of accident records on each road section. Then,the sections containing more than 3 accident records in a monthwill be considered as dangerous road sections in our experiments.To select the best hyper-parameters for all the comparing meth-ods, we randomly split each dataset into three parts with 60% fortraining, 20% for validation and 20% for test. 5.1.2Baselines. We compare SHGNN with a variety of state-of-the-art GNN models, including two classical message passing neu-ral networks (GCN and GAT ), five representative meth-ods for heterophilic graphs (Mixhop , FAGCN , NLGCN, GPRGNN and GBKGNN ), two spatial GNN models(SAGNN and PRIM ), as well as three task-specific base-lines (KnowCL for CAP, NNCCRF for CP and RFN for DRSD). Detailed descriptions are introduced in Appendix A.3. 5.1.3Evaluation Metrics. For the two regression tasks, we evaluateall methods with Root Mean Square Error (RMSE), Mean AbsoluteError (MAE) and the coefficient of determination (R2). For the nodeclassification task, we use Area Under Curve (AUC) and F1-score.",
  "Overall Comparison. The performance comparison of ourSHGNN and baselines is presented in , in which the meanand standard deviation of all metrics are obtained through five": "random runs. As we can see, SHGNN consistently achieves the bestperformance in three tasks on two kinds of urban graphs, with 6.6%and 11.2% reductions of RMSE in commercial activeness prediction(CAP) and crime prediction (CP), as well as 7.2% improvements ofAUC in dangerous road section detection (DRSD) over the mostcompetitive baseline of each task. We also conduct a pairwise t-testbetween SHGNN and each baseline to demonstrate that our modeloutperforms all of them significantly. Note that although the spatialdiversity of heterophily on the road network in DRSD task is not sostrong ( = 0.23 and = 0.14) as another two urban graphs, ourmodel can still improve the accuracy in a large margin. It indicatesthe effectiveness of SHGNN can be general but not just limited tourban graphs with strong spatial heterophily.Specifically, the ordinary GNN models (GCN and GAT) gener-ally have the worst overall performance. By contrast, approachesdesigned to deal with graph heterophily (Mixhop, FAGCN, NLGCN,GBKGNN and GPRGNN) evidently perform better. It indicates theinappropriateness of simply treating an urban graph as a generalhomophilic graph. However, as a specially designed model to han-dle spatial heterophily, our SHGNN remarkably outperforms thesegeneral heterophilic GNNs. The spatial GNN methods (SAGNNand PRIM) perform better than GCN and GAT sometimes, butperform worse than the methods for heterophilic graphs in manycases. And for task-specific baselines, it can also be found that someheterophilic GNNs are level pegging with them (such as Mixhopand GPRGNN vs. KnowCL in CAP task, GBKGNN vs. NNCCRFin CP task and Mixhop vs. RFN in DRSD task). These results alsodemonstrate the importance to take the spatial heterophily intoconsideration when using GNNs over an urban graph. To sum up,our SHGNN is much more effective in considering and alleviatingthe spatial heterophily on urban graphs in all the tasks.5.2.2Ablation Study. To verify the effectiveness of each design inour model, we further compare SHGNN with its five variants: SHGNN-S removes the direction section partition, which onlymodels spatial heterophily from the distance view.",
  "SHGNN-M removes the multi-head partition strategy. SHGNN-C removes the commonality kernel function, withoutsharing common knowledge among spatial groups": "SHGNN-D removes the discrepancy kernel function. It cannotcapture the difference among spatial groups.As shown in , SHGNN outperforms all the variants, provingthe significance of our designs in tackling spatial heterophily. Specif-ically, the performances get worse if we remove either the partitionof direction sections or distance rings (SHGNN-S and SHGNN-R),which indicates the necessity of considering the spatial heterophilyfrom both views. Besides, the rotation-scaling multi-head parti-tion strategy can evidently help to model diverse spatial relations(SHGNN-M). In addition, the performance degrades if the common-ality kernel function is not used, suggesting the effectiveness ofsharing knowledge among neighbors. More importantly, removingthe discrepancy kernel function results in a notable performancedecline, which verifies the importance of further capturing andexploiting the difference information on heterophilic urban graphs. 5.2.3Parameters Analysis. We further investigate the influence ofseveral important hyper-parameters on the performance of SHGNNwhile keeping other parameters fixed. presents the resultsin CP task, and other results are in Appendix A.4.Number of spatial groups /. We first analyze the effectsmade by the number of partitioned sectors and rings . Byincreasing / to partition more subspaces, SHGNN can modelmore diverse spatial relations and further capture the diversity ofspatial heterophily in a more fine-grained manner. However, over-dense partitions bring no further improvements but even slightperformance declines. A possible explanation is that some subspacescontain too few neighbors to support its representation learning.Partition head number /. We also study the impact ofhead number / in the multi-head partition strategy. It canbe observed that, compared to the single partition (, = 1),SHGNN using such a strategy (, = 2) can evidently performbetter, thanks to the complementing role between two heads. When and continue to increase, the model generally gets fewerfurther improvements, and too many heads with additional redun-dancy may sometimes result in performance degradation. Thus, werecommend to set a small head number but larger than 1(e.g., 2),which is good enough while keeping efficiency.",
  "RELATED WORK": "Here we briefly review two related topics: GNNs for urban applica-tions and GNNs with heterophily.GNNs for Urban Applications. As a powerful approach torepresenting relational data, GNN models are widely adapted inrecent studies to learn on urban graphs, and achieve remarkableperformance in various applications, including traffic forecasting, bike demand prediction , region em-bedding , regional economy prediction and specialregion discovery . There are a few works that tend to encodethe location information in GNNs message passing process in a special domain (POI relation prediction). But these methodsfail to generalize to urban graphs with heterophily, which may sig-nificantly degrade their performance in other urban applications.GNNs with Heterophily. Our research is also related to thestudies of graph heterophily. Here we only make a brief introductionto heterophilic GNNs and refer readers to a recent comprehensivesurvey . Such approaches solve the heterophily problem basi-cally in the following two ways. The first branch is to reconstructthe homophilic neighborhood with similar nodes on the graph mea-sured by different criteria. The used criteria include the structuralsimilarity defined by the distance in latent space or degreesequence , the difference of attention scores , cosine similar-ity of node attributes , nodes ability to mutually representeach other and so on. However, as pointed out by He et al. ,these methods will damage the network topology and tamper withthe original real-world dependencies on the urban graph.Another branch tends to modify the GNN architecture to handlethe difference information on heterophilic graphs, in contrast tothe Laplacian smoothing of typical GNNs, such as processingneighbors in different classes separately , explicitly aggregat-ing features from higher-order neighbors in each layer , al-lowing the high-frequency information by passing signed messages, and combining outputs of each layer (includingego features) to also empower the GNNs with a high-pass ability. However, most of these methods do not consider thediversity of dissimilarity distribution between the central node anddifferent neighbors, especially with different spatial relations.",
  "CONCLUSION": "In this paper, we studied the unique spatial heterophily of the urbangraph and developed a spatial heterophily-aware graph neural net-work. We designed a spatial diversity score to uncover the diversityof heterophily at different spatial locations in the neighborhood,and showed the limitation of existing GNNs for handling diverseheterophily distributions on urban graphs. Further, motivated bythe analysis that spatially close neighbors present a more similarmode of heterophily, we proposed a novel method, named SHGNN,which can group spatially close neighbors together and separatelyprocess each group with less diversity inside, to tackle the spa-tial heterophily in a divide-and-conquer way. Finally, extensiveevaluations demonstrate the effectiveness of our approach.",
  "Karen Simonyan and Andrew Zisserman. 2014. Very deep convolutional networksfor large-scale image recognition. arXiv preprint arXiv:1409.1556 (2014)": "Chao Song, Youfang Lin, Shengnan Guo, and Huaiyu Wan. 2020.Spatial-temporal synchronous graph convolutional networks: A new framework forspatial-temporal network data forecasting. In AAAI, Vol. 34. 914921. Susheel Suresh, Vinith Budde, Jennifer Neville, Pan Li, and Jianzhu Ma. 2021.Breaking the Limit of Graph Neural Networks by Improving the Assortativity ofGraphs with Local Mixing Patterns. In SIGKDD. 15411551.",
  "Zonghan Wu, Shirui Pan, Guodong Long, Jing Jiang, and Chengqi Zhang. 2022.Beyond low-pass filtering: Graph convolutional networks with automatic filtering.TKDE (2022)": "Yanxin Xi, Tong Li, Huandong Wang, Yong Li, Sasu Tarkoma, and Pan Hui.2022. Beyond the First Law of Geography: Learning Representations of SatelliteImagery by Leveraging Point-of-Interests. In WWW. 33083316. Tong Xia, Junjie Lin, Yong Li, Jie Feng, Pan Hui, Funing Sun, Diansheng Guo, andDepeng Jin. 2021. 3dgcn: 3-dimensional dynamic graph convolutional networkfor citywide crowd flow prediction. TKDD 15, 6 (2021), 121.",
  "In this section, we make a supplementary explanation of the con-struction of three real-world datasets in three tasks": "A.1.1Commercial Activeness Prediction (CAP). Following manyprevious studies (e.g. ) that divide a city into grids for variousurban analyses, we also divide Shenzhen city into a set of 128 128 grids, which are regarded as the regions in this task. Weconstruct two groups of region features for commercial activenessprediction, which are POI features and satellite image features.A. POI Features. We construct three types of POI features fromthe POI data, to reflect a regions functionality, which is highlycorrelated with commercial activeness .(a) Category Distribution. For each region, we compute the ratiosof different categories of POIs, to obtain the category distributionhistogram as a feature vector. The total number of POIs is alsoappended in this vector. In our experiments, we consider the follow-ing 23 categories: Food Service, Hotel, Shopping Place, Life Service,Beauty Industry, Scenic Spot, Leisure and Entertainment, Sportsand Fitness, Education, Cultural Media, Medicine, Auto Service,Transportation Facility, Financial Service, Real Estate, Company,Government Apparatus, Entrance and Exit, Topographical Object,Road, Railway, Greenland, and Bus Route. To include more sur-rounding information, we also compute the distribution in the 3 3regions centered by the given region.(b) POI Radius. This feature is defined as the shortest distancebetween a certain type of POIs and the region, such as hospitalradius. The distance is discretized into different buckets (< 0.5,0.5 1.5, 1.5 3 and > 3). We calculated 15 kinds ofradius in total: Hospital, Clinic, College, School, Bus Stop, Sub-way Station, Airport, Train Station, Coach Station, Shopping Mall,Supermarket, Market, Shop, Police Station, and Scenic Spot.(c) Perfect Degree of Living Facility. Its a binary index that reflectswhether residents can satisfy their daily consumption demandsaround the region. It will be assigned one if there are all the follow-ing types of facilities within 1 of the current region, which areMedical Service, Shopping Place, Sports Venue, Education Service,Food Service, Financial Service, Communication Service, PublicSecurity Organ and Transportation Facility. We select these typesof POIs according to the official document 4.B. Satellite Image Features. The satellite image data are 3-channel 256 256 RGB images with 0.5 spatial resolution. We usethe pre-trained VGG16 with the last two dense layers removed,to extract semantic features from the satellite image of each region. A.1.2Crime Prediction (CP). We provide more details about theManhattan dataset. As introduced in : (1) Census block datacontains the boundaries of 180 regions split by streets in Manhattan.(2) Taxi trip data records around 10 million taxi trips during onemonth among regions. (3) POI data includes information of nearly20 thousand POIs, which can be divided into 14 categories. (4)Crime data consists of more than 35 thousand crime records duringone year in these 180 regions. We construct 14-dimensional POIcategory distribution region features similar to CAP task. A.1.3Dangerous Road Section Detection (DRSD). We further in-troduce the road data and traffic accident record data used to buildthe Los Angeles dataset. The road data describes the location andconnecting relationship of road sections in a city. It is used to buildthe graph of road networks, where nodes are road sections, andedges are added between connected sections. For each node, weapply Deepwalk to generate the embedding as node features.As for the accident data, it records the occurrence time and locationof nearly 20 thousand car accidents in December 2021.",
  "A.2Implementations": "We first introduce some basic settings (e.g., input and output layers)for three tasks. For CAP task, since the input POI and satellite imagefeatures are from different modalities, we apply two dense layerswith 64 hidden units to transform them into the same space, andconcatenate them together to obtain the initial representation (i.e.,(0)) of each region. For CP task, the 14 POI category features aredirectly used as the initial representation. For DRSD task, the noderepresentation is initialized by the 64- embedding vector learnedby Deepwalk algorithm , where we set the walk length as 10,the number of random walk as 80, and the window size as 5. Asfor the output layer, we adopt Linear Regression to get the finalprediction in CAP and CP task. For the node classification in DRSDtask, we use Logistic Regression to obtain the output probability.Moreover, for all three tasks, we use Adam optimizer for modeltraining with the learning rate set to 0.001.Next, we introduce other hyper-parameter settings in SHGNN.For rotation-scaling spatial aggregation module, we set the headnumber = = 2 to divide neighbors from both the directionand distance view. Specifically, we partition = 4 sectors undereach head and the rotation angle is set to 45 degrees for all threetasks. In the distance view, we set different ring numbers in threetasks. For CAP task and CP task, we partition = 3 rings perhead, and the interval of each distance bucket is set to 1.5 (underthe head = 1) and 2.5 (head = 2), while for DRSD task,we set = 2 with 100 (head = 1) and 200 (head = 2) asbucket intervals. The hidden size is set to 32 for all the tasks. Forheterophily-sensitive spatial interaction module, the hidden size ofthe two dense layers used to fuse two spatial views are set to 32,128, and 32 for CAP, CP, and DRSD task, respectively. We applyone SHGNN layer between the input and output layer to learn thenode representation based on the urban graph.",
  "SAGNN includes the spatial information of neighbors infeature aggregation. It considers neighbors direction by splittingsectors, and processes their relative position by dividing grids": "PRIM is a GNN-based framework working on POI graphs,with the consideration of geographical influence. When aggre-gating neighbor features, it modifies the attention score with aspatial distance score calculated by radial basis function (RBF). KnowCL is specifically designed for socioeconomic predic-tion. It uses GCN encoder to extract multiple knowledge froman urban knowledge graph, and infuse it to regions visual repre-sentation through cross-modality contrastive learning.",
  "A.4Additional Experimental Results": "Efficiency. We also conducted an experiment in CAP task to evalu-ate the efficiency of SHGNN. We compare SHGNN and all baselinesin this task, in terms of the training time per epoch and the infer-ence time of an instance. As shown in , the efficiency ofSHGNN is affordable (0.392 seconds for training one epoch, and0.018 seconds for inferring one instance), since our model can han-dle spatial heterophily on the urban graph, and achieves significantperformance improvements over all baselines.Parameter Analysis. The results of parameter analysis in CAPand DRSD task are shown in and 8.",
  "O(( + )|V|2 + ( + )|E|),": "where |V| and |E| denote the number of nodes and edges, and denotes the node feature dimension. and denote the numberof sectors and rings. and are head numbers of the multi-head sector partition in direction view and ring partition in distanceview. To explain, in the direction view, the term O( |V|2) isthe cost of feature transformation for nodes in different sectors,under heads of sector partitions. And O( |E|) correspondsto the cost of the feature aggregation process. Similarly, the partO( |V|2 + |E|) is for the distance view. Number of Sectors ns 7.4 7.5 7.6 7.7 7.8 7.9 RMSE 4.4 4.6 4.8 5.0 MAE",
  "NotationDescription": "GThe urban graphV, E, The node set, edge set and node attributes of GN( )The neighborhood of node on GThe representation of node , The partitioned direction sector and distance ringN ( )The direction-aware neighborhood of node N ( )The distance-aware neighborhood of node ,The representation of sector around node ,The representation of ring around node",
  "O(( + )|V|2 + (2 + 2 )|V|),": "where the first term is to extract the common knowledge / differ-ence information, and the second term is the cost to compute thecommonality / dissimilarity degree among sectors and among rings.Then, the computation cost of attentive component selection is alsoO(( + )|V|2). Overall, the total complexity of SHGNNis the combination of the above two modules:"
}