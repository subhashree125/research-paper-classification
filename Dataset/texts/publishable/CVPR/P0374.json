{
  "Abstract": "In recent interactive segmentation algorithms, previousprobability maps are used as network input to help predic-tions in the current segmentation round. However, despitethe utilization of previous masks, useful information con-tained in the probability maps is not well propagated to thecurrent predictions. In this paper, to overcome this limita-tion, we propose a novel and effective algorithm for click-based interactive image segmentation, called MFP, whichattempts to make full use of probability maps. We first mod-ulate previous probability maps to enhance their represen-tations of user-specified objects. Then, we feed the modu-lated probability maps as additional input to the segmenta-tion network. We implement the proposed MFP algorithmbased on the ResNet-34, HRNet-18, and ViT-B backbonesand assess the performance extensively on various datasets.It is demonstrated that MFP meaningfully outperforms theexisting algorithms using identical backbones. The sourcecodes are available at",
  ". Introduction": "Interactive image segmentation is a task that aims to seg-ment objects of interest given guidance through user an-notations.It enables users to select objects and delin-eate them easily, so it is useful in many applications suchas image editing and medical image analysis.With therapid development of deep-learning-based algorithms fordense prediction tasks, demands for annotated data have in-creased significantly. However, obtaining pixel-level anno-tations is costly due to its laborious and time-consumingtraits.With the employment of interactive segmentationtechniques, these labeling costs could be reduced.It ishence essential to develop an effective interactive segmen-tation algorithm.Various forms of user annotations have been adopted ininteractive image segmentation, including bounding boxes, scribbles , and clicks [3, 7, 14, 17, 19",
  "Proposed": ". Utilization of previous probability information in thecurrent segmentation round: The conventional click-based interac-tive segmentation algorithm SimpleClick fails to capture thedetails contained in the previous probability maps. On the otherhand, the proposed algorithm exploits the shape details in the pre-vious probability maps to yield a better segmentation result in thecurrent round. 21, 26, 27, 29]. However, click-based interactions have be-come the mainstream methods due to their simplicity andwell-established studies.In click-based methods, a usersuccessively places foreground or background clicks to ob-tain a segmentation mask.Every time the user places aclick, the segmentation mask is updated. Then, based onthe segmentation mask, the user provides a new click onthe mislabeled areas. This is repeatedly performed until adesired result is obtained. In this work, we attempt to de-velop a novel and more effective framework for click-basedinteractive image segmentation.Recently, deep-learning-based techniques have shownpromising results for interactive image segmentation. Whileearly deep methods feed only an input image and click mapsto the segmentation networks, Sofiiuk et al. tried to ex-ploit previous segmentation masks by taking them as addi-tional input to their segmentation network. They demon-strated that making the network model aware of previous",
  "arXiv:2404.18448v1 [cs.CV] 29 Apr 2024": "masks improves the stability of the model. Since then, tak-ing previous masks (or previous probability maps) as thenetwork input has become a standard pipeline for click-based interactive segmentation. However, even though sev-eral algorithms use previous probability maps to generatecurrent predictions, we observe that the information in theprevious probability maps is not well propagated to the cur-rent predictions. Examples of these observations are pre-sented in .To overcome these limitations, we propose a novel in-teractive segmentation framework, called Making Full useof Probability maps (MFP), to make better use of previousprobabilities. Previous probabilities predicted by a segmen-tation network provide information such as the shape of atarget object, while user clicks give accurate informationfor discerning foreground regions from background ones.In this paper, we first introduce the notion of probabilitymap modulation to combine these two types of informationand yield a better representation of the target object. Wepropose taking a modulated probability map as additionalinput to the network. Thus, we extend the existing inter-active segmentation framework as shown in . Ex-periments on four benchmark datasets demonstrate that theproposed MFP framework achieves excellent results whenimplemented on three different backbone networks.The major contributions of this work can be summarizedas follows. We propose the first modulation scheme for previousprobability maps that enhances the representation of user-specified objects.",
  ". Interactive Image Segmentation": "Extensive research has been carried out to solve the prob-lem of interactive image segmentation. For instance, Rotheret al. proposed an early method, which takes inter-active segmentation as a graph-based optimization prob-lem. Such traditional methods rely on handcrafted features,thus they suffer from relatively low performance. With theemergence of deep learning, Xu et al. first employeda convolutional neural network to perform interactive seg-mentation. They encoded user clicks into click maps viathe distance transform, and used them with an RGB im-",
  "(b) Proposed Algorithm": ". (a) Existing algorithms take an input image I, click mapCt, and previous probability map P t1 as input to the segmenta-tion network. From these input signals, they extract feature F tBand directly feed it into the segmentation head to obtain the cur-rent probability map P t. Then, P t is thresholded to the final objectmask Y t. (b) In contrast, the proposed MFP algorithm modulatesP t1 into P t1 and takes it as additional input to the network.Furthermore, MFP late-fuses probability-related feature F tP withbackbone feature F tB before the segmentation head. age as the network input. Since then, their idea of takingclick maps as network input has become a de facto standardin deep-learning-based methods . Althoughclick maps clearly represent the annotated labels in user-clicked locations, the output of the segmentation networkis not guaranteed to have correct labels in those locations.To overcome this limitation, Jang and Kim introducedthe backpropagating refinement scheme (BRS), which is aninference-time optimization procedure that corrects the mis-labeled clicks. Inspired by this work, Sofiiuk et al. de-veloped the f-BRS algorithm, which refines features insteadof click maps. However, these BRS methods need to runbackward gradient passes during the inference, demandinghigher computational costs in general.",
  ". Utilization of Previous Masks": "Forte et al. and Sofiiuk et al. started adding previ-ous segmentation masks as network input in the current seg-mentation round. In particular, Sofiiuk et al. demon-strated that even without additional optimization schemes,a simple feed-forward model using previous masks couldachieve promising results. After their work, recent inter-active segmentation methods in all usethe segmentation masks in previous segmentation rounds asnetwork input. To further improve the segmentation perfor-mance, Chen et al. and Lin et al. proposed to refinesegmentation results within a local window. After obtain-ing a global prediction, their methods also predict local re-sults on cropped image regions around clicks and use thelocal predictions to refine the global prediction. Zhou et al.",
  ". Overview of the proposed MFP algorithm. In the click map, foreground and background clicks are depicted in green and red,respectively": "formulated the problem of interactive segmentation asGaussian process classification, and Du et al. proposedto use self-attention and correlation modules for propagat-ing click information to unclicked locations. Liu et al. focused on developing a more effective backbone network,and leveraged a plain ViT backbone that could benefit frompretrained weights. Although all these methods use previ-ous masks (or previous probability maps) in the current seg-mentation round, none of them attempt to explicitly extractbeneficial information from the probability maps.Thus,they do not use the previous probability maps to their fullpotential.",
  ". Proposed Algorithm": "is an overview of the proposed MFP algorithm.In each interactive segmentation round, we first modulatethe probability map, predicted from the previous clicks, tomake it closer to the actual segmentation result the user de-sires, as illustrated in (a). Then, we feed the mod-ulated map as additional input to the segmentation networkin (b). We train the segmentation network using arecursive training scheme.",
  ". Probability Map Modulation": "To fully exploit the useful information in the previous pre-diction, we enhance the shape details of a target object inthe probability map P t1 from the previous round t 1.For regions that are likely to correspond to the target object,we enhance the probability values to make them closer tothe foreground label of 1. On the contrary, for backgroundregions, we lower the probabilities to make them closer tothe background label of 0. To this end, we use the methodof gamma correction .",
  "M = {x : x u R}(1)": "where R is the radius of the window, representing the atten-tion scope of the current click u.Suppose that pixel x belongs to the modulation window,i.e. x M. Also, let Px denote the probability of x ina probability map P. Then, P t1xis modulated to P t1xby gamma correction. Let l(u) be the label that the userprovides at the current click u. Note that user clicks areprovided on mislabeled areas. Therefore, if a foregroundclick is given with l(u) = 1, it indicates that a backgroundlabel was assigned to u in the last round and P t1u< 0.5.Since the user intends to assign a foreground label to u, weincrease the probabilities of pixels in M. Therefore, whenl(u) = 1, we perform the increasing modulation",
  "for each x M, as shown in (b)": "Assignment of : We assign different values of gamma formodulating each pixel x in M. The assignment is done ac-cording to how far x is from the given click u. For theclick itself, the desired value P t1uis clear; it is desired thatP t1u 1 if l(u) = 1, and P t1u 0 if l(u) = 0. It ishence natural to assign the biggest gamma to the currentclick u. We set so that P t1u= 0.99 for a foregroundclick and P t1u= 0.01 for a background click. On theother hand, pixels far away from u are less likely to belongto the same object as u, so we assign smaller gamma valuesfor those pixels. For measuring how far a pixel is from theclick, we propose two distance metrics: Euclidean distanceand probability distance. We also develop different gammaassignment schemes for the two distance metrics. summarizes these two schemes.First, we measure how far pixel x is from click u by theEuclidean distance d = x u. In this case, is deter-mined by",
  "R.(4)": "Thus, linearly decreases from to 0, as pixel x movesaway from click u to the boundary of the modulation win-dow M in (1).Second, assuming that similar pixels in the same re-gion would be assigned similar probabilities by the seg-mentation network, we define the probability distance d =(P t1x P t1u)2 between x and u. In other words, pixel xis considered farther from click u when its probability P t1xdiffers more from P t1u. In this case, the maximum distancecannot be bounded by the radius R of the modulation win-dow M. Instead, we measure the probability distances ofall pixels in M from click u. Let d denote the median ofthese distances. Then, we determine by",
  "GT": ". Examples of the probability map modulation via (5).From top to bottom: previous probability maps P t1 before mod-ulation with current clicks, modulated probability maps P t1, andground-truth masks of target objects. d = d. When d > d, we assume that x and u are unlikelyto belong to the same region and set = 1.We adopt the probability-distance-based scheme in (5)for early clicks up to the Nth click and the Euclidean-distance-based scheme in (4) for later clicks. This is be-cause, in early rounds, rough and large-scale object shapestend to remain in P t1. On the other hand, in late rounds,the distinction between the target object and the backgroundbecomes clearer, and fine-scale information is required forbetter segmentation. However, P t1 does not contain suchfine-scale information in general. Thus, the Euclidean dis-tance is used instead in late rounds. shows ex-amples of the probability map modulation via the gammaassignment scheme in (5). Assignment of R: We set the radius R of M to be Rmax.However, when there are previous clicks of the oppositetype, we set R to be half the minimum distance of the cur-rent click u to an opposite click. Thus, we set",
  ". Network Architecture": "After obtaining the modulated probability map P t1, wefeed it together with the input image I, click map Ct, andoriginal probability map P t1 into the segmentation net-work, as depicted in (b). For the interactive seg-mentation task, we adopt a common semantic segmentationnetwork as the backbone for feature extraction. However,the semantic segmentation network takes only an RGB im-age as input. To handle the additional input Ct, P t1, andP t1, we concatenate them, and embed the concatenation",
  "MFP (Proposed)ViT-B1.381.481.921.392.176.183.925.3211.273.215.2411.20": "and the input image I, respectively, into tensors of the samesize, as done in . Then, we element-wise add thesetensors and convey the sum to the feature extraction net-work. As the feature extraction backbone, we test ResNet-34 , HRNet-18 , and ViT-B of different com-plexities, which are widely used for interactive image seg-mentation. The feature extractor yields a feature map FtB.Existing interactive segmentation algorithms directly in-put the backbone feature FtB into a segmentation head toobtain a segmentation result. In contrast, we propose fusingthe probability maps P t1 and P t1 with FtB. This late fu-sion strengthens the influence of the probability informationon the final segmentation result. Specifically, we first con-catenate I, P t1, P t1 and adjust their spatial resolutionsand channel sizes using two convolution blocks. We thenuse two Xception conv blocks to extract the probability-related feature FtP . Then, we concatenate FtP with FtB andfuse them through four Xception conv blocks. The segmen-tation head processes this fused feature to generate the prob-ability map P t in the current round t. Thresholding this mapyields the final segmentation mask Y t.",
  ". Recursive Training": "As the proposed MFP algorithm uses P t1 to predict P t,its training requires an ordered series of clicks and the cor-responding probability maps. Sofiiuk et al. , one of thefirst methods to use previous probability maps in interactivesegmentation, adopt an iterative sampling strategy. Theyfirst sample user clicks randomly, as done in . Afterthe random clicks, they add 0 3 clicks iteratively basedon the errors in the network prediction results. Althoughthey partly train the model by mimicking user interactions,they still resort to random sampling initially. Thus, for ini-tial clicks, there are no previous probability maps, and theprobability modulation cannot be performed. Therefore, inthis work, we develop a fully recursive training strategy toexploit the information in the ordered series of interactiveclicks. More specifically, we start the training of an image by sampling the first click near the center of a target object.Then, by comparing the result of the segmentation networkwith the ground truth, we select the next click near the cen-ter of the biggest error region. This recursive selection andtraining is performed up to 24 clicks for an image.",
  "SBD: It is divided into training and validation sets. Thetraining set has 8,498 images with 20,172 instance masks,and the validation set has 2,857 images with 6,671 masks": "COCO + LVIS: COCO consists of 99K images with 1.2Minstance masks, and LVIS has 100K images with 1.2Mmasks. As in , we combine these two datasets anduse 104K images with 1.6M instance masks for training. Evaluation Metrics: To evaluate the proposed algorithm,we use two performance measures. First, we report the NoCscore, which is the average number of clicks required toachieve a certain intersection-over-union (IoU) ratio. Previ-ous studies usually set the target IoU ratio as 90% and reportNoC@85 and NoC@90 for assessment. However, recentmethods yield high-quality segmentation results. Therefore,we set the target IoU score as 95% and report NoC@95additionally. Second, we plot the mean intersection-over-",
  "Input Image & GTFocalClickEMC-ClickSimpleClickProposedInput Image & GTFocalClickEMC-ClickSimpleClickProposed": ". Qualitative comparison of algorithms trained on the COCO+LVIS dataset. We compare the proposed MFP with conventionalalgorithms that employ previous masks as input: FocalClick , EMC-Click , and SimpleClick . Rows (a) show input images withclicks and prediction masks overlayed. Rows (b) and (c) show previous probability maps and current prediction masks, respectively. Notethat the algorithms are compared fairly using the same automatic clicking strategy. Since the algorithms produce different segmentationresults, click locations may differ accordingly.",
  "union (mIoU) score according to the number of clicks andreport the area under the curve (AUC)": "Implementation Details: The proposed MFP can be imple-mented upon various backbone networks. In this work, weimplement three versions based on the ViT-B , HRNet-18 + OCR , and ResNet-34 + DeepLabv3+ backbones. Also, we use the SBD and COCO + LVIS datasets for training. We apply random resizing,cropping, flipping, rotation, and brightness control for dataaugmentation. We minimize the normalized focal loss using the Adam optimizer with 1 = 0.9 and 2 = 0.999.We fix the hyperparameters in the probability map modu-lation to N = 7 and Rmax = 100 in all experiments. Forevaluation, results can be greatly affected by how a userplaces clicks. Thus, for reliable assessment, we adopt theautomatic clicking strategy used in .",
  ". Comparative Assessment": "Comparison with state-of-the-art methods: We first com-pare the proposed MFP (ViT-B) with conventional interac-tive segmentation algorithms using the NoC metrics. Somemethods employ large transformers including ViT-B, ViT-Land ViT-H. The best performances by the recent methodsare obtained using the ViT-H backbone. However, ViT-H suffers from high computational costs due to its large num-ber of parameters. For this reason, we compare the pro-posed algorithm with the state-of-the-art methods by em-ploying ViT-B. Early algorithms were trained on the SBDdataset only, while recent methods are trained on SBD andCOCO + LVIS, respectively. We report the results of MFPunder both training settings following the recent methods. compares the results using the SBD training data.For the methods that presented multi-ple versions of their algorithms, we report their best NoCscores. Looking at the table results, we see that MFP outper-forms the existing algorithms significantly. Note that MFPis the only algorithm that achieves a mean IoU of 85% withless than four clicks for all the datasets. Also, MFP yieldsthe best results in 9 out of 12 tests, and the second-best re-sults in the remaining three tests. compares qualitative segmentation results of theproposed MFP with those of FocalClick , EMC-Click, and SimpleClick . We can see that at the same num-ber of clicks, MFP provides more accurate segmentation re-sults. We also visualize previous probability maps P t1 inrows (b) of . Unlike the existing algorithms, whosesegmentation masks are inaccurate in regions far from theclicks (e.g. the bicycle wheels), MFP manages to make cor-",
  "iCMFormer ViT-B1.361.42-1.422.52-4.055.58-3.335.31-SimpleClick ViT-B1.401.542.161.442.466.704.105.4812.243.285.2411.24MFP (Proposed)ViT-B1.381.481.921.392.176.183.925.3211.273.215.2411.20": "rect predictions in those regions. Specifically, the previousprobability maps of both SimpleClick and MFP contain in-formation about the wheel shapes, but only MFP can seg-ment out the wheels. From this observation, we believe thatthe proposed MFP algorithm makes better use of the infor-mation in previous masks. compares the results using the COCO + LVIStraining data. Out of 12 NoC scores compared, MFP out-performs the existing algorithms in seven tests and rankssecond in the remaining five tests. This demonstrates thatthe proposed MFP algorithm exceeds or shows comparableresults to the state-of-the-art methods. Comparison of IoU & AUC: compares the pro-posed MFP in terms of mean IoU ratios with four compa-rable algorithms trained on the SBD dataset: CDNet ,RITM , GPCIS , SimpleClick . We see thatMFP generally achieves higher mean IoU ratios with thesame number of clicks than the conventional algorithms. Tonumerically prove the superiority of MFP, we also report theAUC scores. MFP shows the highest AUC scores on all fourdatasets. Comparison using identical backbones: Using strongerbackbones greatly impacts the performance of interactivesegmentation algorithms. Thus, to make fair comparisonswith existing methods, we test the proposed MFP algorithm using three different backbones: ResNet-34 , HRNet-18, and ViT-B . We choose ViT-B as the main backbonefollowing the state-of-the-art methods in . As ViT-Bis a heavy network, we also choose relatively lighter back-bones ResNet-34 and HRNet-18, which are employed bymany other interactive segmentation methods. In ,we compare the three versions of MFP with conventionalalgorithms that use the same backbone networks. Out oftotal 36 settings compared, MFP shows superiour results in28 settings. Even for the cases where MFP does not achievethe highest scores, MFP yields comparable performance tothe best results with margins less than 0.1. This demon-strates the effectiveness and generality of the proposed MFPframework.",
  ". Ablation Study": "We conduct ablation studies to verify the efficacy of eachcomponent of the proposed algorithm, using the SBD train-ing data. For evaluation, we choose the DAVIS dataset .DAVIS has high-quality annotations and covers many dif-ferent scenarios, thus we found the DAVIS results moreconvincing as compared with other datasets. The results arepresented in . We first implement a baseline model(Method I) based on ViT-B. Method I does not take mod-ulated probability maps as additional input and follows the . Comparison of the mean IoU scores according to the number of clicks on the GrabCut, Berkeley, DAVIS, andSBD datasets. The models are trained on the SBD datasets. The legend of the graph contains the AuC score for each algorithm.",
  "IV.3.925.3211.27": "same network architecture and training scheme as the pre-vious algorithm . In method II, we explore the effect ofthe late fusion strategy, by excluding the fusion layer. Formethod III, we follow the training procedure in , insteadof the recursive training. When random sampling simulatesclicks, since there is no order in the clicks, we randomlytake any click and consider it as the current click to per-form the probability map modulation. Method IV employsall components proposed in this work, so it is the same asthe proposed algorithm.Looking into the results in , we can see thatmethod IV, which employs all components, yields the bestperformance. This indicates that all components contributeto performance improvements. Comparing the results be-tween pairs of methods, we find that the performance gainfrom method II to IV is conspicuous for NoC@85, while that from method III to IV stands out for NoC@95. Fromthis observation, we deduce that fusing probability infor-mation in a late layer has great impact for quickly obtainingcoarse predictions, while the recursive training scheme aidsin fine-level tuning for higher accuracy.",
  ". Conclusions": "A novel click-based interactive segmentation framework,called MFP, which fully exploits previous probability mapswas proposed in this paper.First, MFP modulates pre-vious probability maps based on click information to ob-tain better representations of user-specified objects. Then,it propagates the additional information to the segmenta-tion network, which was designed by extending the exist-ing interactive segmentation framework. Experimental re-sults demonstrated that MFP outperforms conventional al-gorithms when identical backbones are employed.",
  "Kevin McGuinness and Noel E Oconnor. A comparativeevaluation of interactive segmentation algorithms. PatternRecognition, 43(2):434444, 2010. 5, 8": "Federico Perazzi, Jordi Pont-Tuset, Brian McWilliams, LucVan Gool, Markus Gross, and Alexander Sorkine-Hornung.A benchmark dataset and evaluation methodology for videoobject segmentation. In CVPR, pages 724732, 2016. 5, 7, 8 Amit Kumar Rana, Sabarinath Mahadevan, Alexander Her-mans, and Bastian Leibe. Dynamite: Dynamic query boot-strapping for multi-object interactive segmentation trans-former. arXiv preprint arXiv:2304.06668, 2023. 7"
}